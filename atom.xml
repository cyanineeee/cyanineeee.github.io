<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://cyanineeee.github.io</id>
    <title>cyanine</title>
    <updated>2024-09-30T09:08:21.961Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://cyanineeee.github.io"/>
    <link rel="self" href="https://cyanineeee.github.io/atom.xml"/>
    <subtitle>my personal blog</subtitle>
    <logo>https://cyanineeee.github.io/images/avatar.png</logo>
    <icon>https://cyanineeee.github.io/favicon.ico</icon>
    <rights>All rights reserved 2024, cyanine</rights>
    <entry>
        <title type="html"><![CDATA[git pr è¿›è¡Œ mergeæ—¶çš„å†²çªè§£å†³]]></title>
        <id>https://cyanineeee.github.io/post/git-pr-jin-xing-merge-shi-de-chong-tu-jie-jue/</id>
        <link href="https://cyanineeee.github.io/post/git-pr-jin-xing-merge-shi-de-chong-tu-jie-jue/">
        </link>
        <updated>2024-09-30T02:10:30.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>é¦–å…ˆæ˜¯è‡ªå·±æäº¤çš„prå’Œä¸»åˆ†æ”¯å‡ºç°äº†å†²çª åˆå¹¶è¢«reject</li>
<li>ç„¶åå…ˆæ‹‰å–ä¸»åˆ†æ”¯ ç¡®è®¤æœ¬åœ°æœ‰ä¸¤ä¸ªï¼š**<em>å½“å‰åˆ†æ”¯</em> **å’Œ <em><strong>ä¸»åˆ†æ”¯</strong></em></li>
<li>ç„¶åå°†æ‹‰å–åˆ°æœ¬åœ°çš„ä¸»åˆ†æ”¯å’Œè‡ªå·±çš„åˆ†æ”¯åœ¨æœ¬åœ°mergeï¼ˆæ˜¯<em><strong>æœ¬åœ°</strong></em> ä¸Š  <em><strong>å°†è¿œç¨‹åˆ†æ”¯åˆå¹¶åˆ°è‡ªå·±çš„åˆ†æ”¯</strong></em>ï¼‰</li>
<li>é€æ–‡ä»¶ã€é€è¡Œç¡®è®¤å†²çªï¼Œæ˜¯ä¿ç•™è‡ªå·±çš„ï¼Ÿä¿ç•™ä¸»åˆ†æ”¯ï¼Ÿæˆ–æ˜¯ä¸€èµ·ä¿®æ”¹ï¼Ÿ</li>
<li>ç¡®è®¤å®Œæˆä¹‹åï¼Œå³è¿œç«¯å’Œè‡ªå·±çš„åˆ†æ”¯åœ¨<em><strong>æœ¬åœ°</strong></em>åˆå¹¶å®Œæ¯•</li>
<li>ç„¶åå°†è§£å†³å†²çªå®Œæˆçš„è‡ªå·±çš„åˆ†æ”¯æäº¤åˆ°<em><strong>è¿œç¨‹ä»“åº“çš„è‡ªå·±çš„åˆ†æ”¯</strong></em></li>
<li>åœ¨è´Ÿè´£äººç¡®è®¤æ— è¯¯å åŒæ„æœ¬æ¬¡prå³å®Œæˆå†²çªè§£å†³</li>
</ul>
<pre><code> #å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤
 #æŸ¥çœ‹åˆ†æ”¯
 git branch
 #åˆ‡æ¢åˆ†æ”¯
 git checkout 
 #æŸ¥çœ‹åˆ†æ”¯æ›´æ–°æ—¥å¿—(æœ‰åˆ†æ”¯çš„ç¼–ç ) ç”¨æ¥æ¯”å¯¹å†²çªçš„åˆ†æ”¯çš„ç‰ˆæœ¬ã€å¯¹æ¯”å½“å‰åˆ†æ”¯æ˜¯å¦æ˜¯æœ€æ–°çš„
 git log
 #å°†branchnameåˆå¹¶åˆ°å½“å‰åˆ†æ”¯
 git merge&lt;branchname&gt;
 # åˆ‡æ¢åˆ°åˆ†æ”¯branchname
 git checkout  &lt;branchname&gt;
 # æŸ¥çœ‹ä»“åº“çŠ¶æ€ å†²çªçš„æ–‡ä»¶ä¼šæ˜¯çº¢è‰²çš„
 git  status
 #æŸ¥çœ‹å…·ä½“å†²çª
 git diff &quot;å†²çªçš„æ–‡ä»¶&quot;
 # å°†è¿œç¨‹æŒ‡å®šåˆ†æ”¯ æ‹‰å–åˆ° æœ¬åœ°æŒ‡å®šåˆ†æ”¯ä¸Š
 git pull origin &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;
 #å–æ¶ˆå°šæœªå®Œæˆå†²å‡ºå¤„ç†çš„merge - å›æ»šåˆ°åˆå¹¶å‰çš„çŠ¶æ€
 git merge --abort

</code></pre>
<ul>
<li>åˆå¹¶å†²çªæ–¹å¼
<ul>
<li>åœ¨vscä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šå±åè°ƒè¿›è¡Œé€‰å–ï¼ˆå·¦å³åˆ†åˆ«ä¸ºæœ¬åœ°ã€ä¸»åˆ†æ”¯ï¼Œåº•éƒ¨ä¸ºåˆå¹¶åçš„ï¼‰</li>
<li>åœ¨å‘½ä»¤è¡Œä¸­ï¼Œéœ€è¦ç»“åˆç¼–è¾‘å™¨è¿›è¡Œä¿®æ”¹</li>
</ul>
<pre><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
ä¿®æ”¹åçš„ä»£ç ï¼ˆå½“å‰åˆ†æ”¯çš„ä¿®æ”¹ï¼‰
=======
ä¿®æ”¹åçš„ä»£ç ï¼ˆå†²çªåˆ†æ”¯çš„ä¿®æ”¹ï¼‰
&gt;&gt;&gt;&gt;&gt;&gt;&gt; branch_name
</code></pre>
è§£å†³å†²çªæ­¥éª¤
<ul>
<li>
<ol>
<li>æ‰“å¼€å†²çªæ–‡ä»¶ï¼Œæ‰¾åˆ°å†²çªéƒ¨åˆ†</li>
</ol>
</li>
<li>
<ol start="2">
<li>æ ¹æ®å®é™…éœ€è¦ä¿®æ”¹ã€ä¿ç•™ã€åˆ é™¤</li>
</ol>
</li>
<li>
<ol start="3">
<li>ä¿å­˜</li>
</ol>
</li>
<li>é€šè¿‡ `git add &quot;ä¿®æ”¹åçš„å†²çªæ–‡ä»¶&quot;æ ‡è®°é—®å·²è§£å†³å†²çªçš„çŠ¶æ€</li>
<li>å…¨éƒ¨è§£å†³å®Œæˆä¹‹å<code>git commit</code>å’Œ  <code>git push</code>è¿›è¡Œæäº¤</li>
</ul>
</li>
</ul>
<h3 id="è¡¥å……-gitè®²è§£stage">è¡¥å…… -- <a href="https://blog.csdn.net/qq_32452623/article/details/78417609">gitè®²è§£stage</a></h3>
<h3 id="è¡¥å……-gitå–æ¶ˆåˆå¹¶çš„æ›´å¤šè®²è§£">è¡¥å…… -- <a href="https://geek-docs.com/git/git-questions/94_git_source_tree_git_how_to_cancel_a_merge.html">gitå–æ¶ˆåˆå¹¶çš„æ›´å¤šè®²è§£</a></h3>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[antd Tableå¤šçº§è¡¨å¤´æ—¶å›ºå®šè¡¨å¤´bug ]]></title>
        <id>https://cyanineeee.github.io/post/antd-table-duo-ji-biao-tou-gu-ding-biao-tou-wei-zheng-li/</id>
        <link href="https://cyanineeee.github.io/post/antd-table-duo-ji-biao-tou-gu-ding-biao-tou-wei-zheng-li/">
        </link>
        <updated>2024-09-27T08:07:35.000Z</updated>
        <content type="html"><![CDATA[<pre><code>import React from 'react';
import { Table } from 'antd';
import type { TableColumnsType } from 'antd';
import { createStyles } from 'antd-style';

const useStyle = createStyles(({ css, token }) =&gt; {
  const { antCls } = token;
  return {
    customTable: css`
      ${antCls}-table {
        ${antCls}-table-container {
          ${antCls}-table-body,
          ${antCls}-table-content {
            scrollbar-width: thin;
            scrollbar-color: unset;
          }
        }
      }
    `,
  };
});

interface DataType {
  key: React.Key;
  name: string;
  age: number;
  street: string;
  building: string;
  number: number;
  companyAddress: string;
  companyName: string;
  gender: string;
}

const columns: TableColumnsType&lt;DataType&gt; = [
  {
    title: 'Name',
    dataIndex: 'name',
    key: 'name',
    width: 100,
    fixed: 'left',
    filters: [
      {
        text: 'Joe',
        value: 'Joe',
      },
      {
        text: 'John',
        value: 'John',
      },
    ],
    onFilter: (value, record) =&gt; record.name.indexOf(value as string) === 0,
  },
  {
    title: 'Other',
    children: [
      {
        title: 'Age',
        dataIndex: 'age',
        key: 'age',
        width: 150,
        sorter: (a, b) =&gt; a.age - b.age,
      },
      {
        title: 'Address',
        children: [
          {
            title: 'Street',
            dataIndex: 'street',
            key: 'street',
            width: 150,
          },
          {
            title: 'Block',
            children: [
              {
                title: 'Building',
                dataIndex: 'building',
                key: 'building',
                width: 100,
              },
              {
                title: 'Door No.',
                dataIndex: 'number',
                key: 'number',
                width: 100,
              },
            ],
          },
        ],
      },
    ],
  },
  {
    title: 'Company',
    children: [
      {
        title: 'Company Address',
        dataIndex: 'companyAddress',
        key: 'companyAddress',
        width: 200,
      },
      {
        title: 'Company Name',
        dataIndex: 'companyName',
        key: 'companyName',
      },
    ],
  },
  {
    title: 'Gender',
    dataIndex: 'gender',
    key: 'gender',
    width: 80,
    fixed: 'right',
  },
];

const dataSource = Array.from({ length: 100 }).map&lt;DataType&gt;((_, i) =&gt; ({
  key: i,
  name: 'John Brown',
  age: i + 1,
  street: 'Lake Park',
  building: 'C',
  number: 2035,
  companyAddress: 'Lake Street 42',
  companyName: 'SoftLake Co',
  gender: 'M',
}));

const App: React.FC = () =&gt; {
  const { styles } = useStyle();
  return (
    &lt;Table&lt;DataType&gt;
      className={styles.customTable}
      columns={columns}
      dataSource={dataSource}
      bordered
      size=&quot;middle&quot;
      scroll={{ x: 'calc(700px + 50%)', y: 47 * 5 }}
    /&gt;
  );
};

export default App;
</code></pre>
<p>ä»¥ä¸Šä»£ç  è™½ç„¶<code>Company Address</code>æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯<code>Company</code>è¡¨å¤´ä¸æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬æœŸæœ›çš„æƒ…å†µæ˜¯ç±»ä¼¼äºè¿™æ ·ï¼š</p>
<pre><code>import React from 'react';
import { Table } from 'antd';
import type { TableColumnsType } from 'antd';
import { createStyles } from 'antd-style';

const useStyle = createStyles(({ css, token }) =&gt; {
  const { antCls } = token;
  return {
    customTable: css`
      ${antCls}-table {
        ${antCls}-table-container {
          ${antCls}-table-body,
          ${antCls}-table-content {
            scrollbar-width: thin;
            scrollbar-color: unset;
          }
        }
      }
    `,
  };
});

interface DataType {
  key: React.Key;
  name: string;
  age: number;
  street: string;
  building: string;
  number: number;
  companyAddress: string;
  companyName: string;
  gender: string;
}

const columns: TableColumnsType&lt;DataType&gt; = [
  {
    title: 'Other',
    children: [
          {
            title: 'Street',
            dataIndex: 'street',
            key: 'street',
            width: 150,
fixed:&quot;left&quot;,
          },
          {
                title: 'Building',
                dataIndex: 'building',
                key: 'building',
                width: 100,
           },
    ],
  },
  {
    title: 'Company',
    children: [
      {
        title: 'Company Address',
        dataIndex: 'companyAddress',
        key: 'companyAddress',
        width: 200,

      },
      {
        title: 'Company Name',
        dataIndex: 'companyName',
        key: 'companyName',
      },
    ],
  },
];

const dataSource = Array.from({ length: 100 }).map&lt;DataType&gt;((_, i) =&gt; ({
  key: i,
  name: 'John Brown',
  age: i + 1,
  street: 'Lake Park',
  building: 'C',
  number: 2035,
  companyAddress: 'Lake Street 42',
  companyName: 'SoftLake Co',
  gender: 'M',
}));

const App: React.FC = () =&gt; {
  const { styles } = useStyle();
  return (
    &lt;Table&lt;DataType&gt;
      className={styles.customTable}
      columns={columns}
      dataSource={dataSource}
      bordered
      size=&quot;middle&quot;
      scroll={{ x: 'calc(700px + 50%)', y: 47 * 5 }}
    /&gt;
  );
};

export default App;
</code></pre>
<p>è¿™æ ·Otherå’ŒStreetè¡¨å¤´å°±ä¼šå›ºå®š -- ä¹Ÿå°±æ˜¯æœ€å·¦ä¾§çš„ä¸¤ä¸ªå›ºå®šï¼ˆå¦‚æœåªåœ¨ä¸­é—´åˆ—æ·»åŠ <code>fixed:&quot;left&quot;</code>æ˜¯ä¸èµ·ä½œç”¨çš„ï¼‰ï¼Œä½†æ˜¯éœ€æ±‚åˆéœ€è¦æœ€å·¦ä¾§çˆ¶åˆ—å’Œä»–çš„å…¨éƒ¨å­åˆ—ä»¥åŠç¬¬äºŒä¸ªçˆ¶åˆ—å’Œä»–çš„ç¬¬ä¸€ä¸ªå­åˆ—å›ºå®šï¼Œæˆ‘çš„æ–¹æ¡ˆæ˜¯é€šè¿‡cssæ”¹å˜å®šä½æ–¹å¼æ¥è§£å†³ã€‚</p>
<pre><code>.user_table .ant-table-wrapper .ant-table-column-sorter {
  position: absolute;
  top: 18px;
  right: 10px;
}
&lt;!-- åŒæ—¶è¯¥å…ƒç´ çš„èƒŒæ™¯è®¾ç½®ä¸ºç™½è‰² --&gt;
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥è¾¾åˆ°å›ºå®šç¬¬äºŒå±‚å¦’çˆ¶çº§è¡¨å¤´çš„æ•ˆæœäº†ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[uwsgi - djangoéƒ¨ç½²]]></title>
        <id>https://cyanineeee.github.io/post/uwsgi-django-bu-shu/</id>
        <link href="https://cyanineeee.github.io/post/uwsgi-django-bu-shu/">
        </link>
        <updated>2023-07-04T11:18:13.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ä»¥ä¸€ä¸ªæœ€åŸºç¡€çš„åˆå§‹django-é¡¹ç›®ä¸ºä¾‹ä¸æ¶‰åŠæ•°æ®åº“">ä»¥ä¸€ä¸ªæœ€åŸºç¡€çš„åˆå§‹django é¡¹ç›®ä¸ºä¾‹ï¼ˆä¸æ¶‰åŠæ•°æ®åº“ï¼‰</h2>
<ol>
<li>å°†djangoé¡¹ç›®çš„ç¯å¢ƒæ‰“åŒ…æˆrequirements.txt</li>
<li>è´­ä¹°ä¸€ä¸ªæœåŠ¡å™¨</li>
<li>å°†æœåŠ¡å™¨å®‰å…¨ç»„è®¾ç½® è®¾ç½®å…¥ç«™è§„åˆ™å…¨å¼€</li>
<li>é…ç½®pythonç¯å¢ƒ
<ul>
<li>æœ¬äººä½¿ç”¨çš„æ˜¯ubuntu 20.04 è‡ªå¸¦python 3.8</li>
<li>é¦–å…ˆå®‰è£…pip - æ³¨ï¼šå¦‚æœ<code>E: Package 'python3.10-venv' has no installation candidate</code>è¯´æ˜ä½ åº”è¯¥æ›´æ–°ä¸€ä¸‹ç³»ç»Ÿçš„å¯å®‰è£…è½¯ä»¶åˆ—è¡¨<code>apt-get update</code></li>
<li>ç„¶åå®‰è£…virtualenv</li>
<li>ç„¶åcdåˆ°æƒ³è¦çš„ç›®å½•ä¸‹ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</li>
<li>cdåˆ°åˆšåˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹å†… source activateå¯åŠ¨ç¯å¢ƒ</li>
</ul>
</li>
<li>é…ç½®é¡¹ç›®ç¯å¢ƒ
<ul>
<li>cdåˆ°é¡¹ç›®æ ¹ç›®å½• æ‰§è¡Œpip install -r requirements.txt ï¼ˆä¸€å®šè¦åœ¨ä¸Šä¸€æ­¥å¯åŠ¨è™šæ‹Ÿç¯å¢ƒä¹‹ååœ¨è¿›è¡Œç¯å¢ƒé…ç½®ï¼‰</li>
<li>è¿è¡Œç»“æŸå³å¯</li>
</ul>
</li>
<li>å®‰è£…uwsgi
<ul>
<li>pip install uwsgiå³å¯</li>
</ul>
</li>
<li>é…ç½®uwsgi.iniæ–‡ä»¶ - åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­çš„åŒåç›®å½•ä¸‹ï¼ˆå°±æ˜¯ä¸ªé»˜è®¤wsgi.pyæ–‡ä»¶åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼‰</li>
</ol>
<pre><code class="language-ini">[uwsgi]
http=0.0.0.0:8000 #è®¾ç½®ä¸º0.0.0.0è¡¨ç¤ºå¤–ç½‘å¯ä»¥è®¿é—® 127.0.0.1è¡¨ç¤ºæœ¬æœºè®¿é—®
chdir=/my/mysite  #é¡¹ç›®æ ¹ç›®å½•
wsgi-file=mysite/wsgi.py   #é¡¹ç›®æ ¹ç›®å½•é‡Œé¢çš„åŒåæ–‡ä»¶å†…çš„wsgi.pyæ–‡ä»¶
process=2 #å¯åŠ¨è¿›ç¨‹æ•° è·ŸæœåŠ¡å™¨cpuæœ‰å…³
threads=2 #çº¿ç¨‹æ•° 
pidfile=uwsgi.pid  #å‚¨å­˜è¿›ç¨‹çš„pid ä»¥ä¾¿äºåé¢åœæ­¢è¿è¡Œ
daemonize=uwsgi.log #æ—¥å¿—æ–‡ä»¶
master=true  #ä¸»è¿›ç¨‹å¯åŠ¨
</code></pre>
<ol start="8">
<li>ç„¶åcdè¿›å…¥åˆ°uwsgi.iniåŒçº§å†…
<ul>
<li>æ‰§è¡Œuwsgi --ini uwsgi.ini å¯åŠ¨</li>
<li>æ­¤æ—¶å°±èƒ½é€šè¿‡å…¬ç½‘ip+ç«¯å£è®¿é—®åˆ°djanoæœåŠ¡äº†</li>
</ul>
</li>
<li>åœæ­¢æœåŠ¡
<ul>
<li>uwsgi --stop uwsgi.pidè¿›å…¥åˆ°uwsgi.iniåŒçº§æ–‡ä»¶å¤¹è¿è¡Œå³å¯<br>
PS. ä½¿ç”¨å‘½ä»¤ ps aux|grep 'uwsgi'å¯ä»¥æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œå‡ºç°å¦‚ä¸‹è¡¨ç¤ºæ­£å¸¸ï¼š</li>
</ul>
</li>
</ol>
<pre><code>root       84204  1.0  3.8  47520 36724 ?        S    11:07   0:00 uwsgi --ini uwsgi.ini
root       84206  0.0  3.0 121252 29816 ?        Sl   11:07   0:00 uwsgi --ini uwsgi.ini
root       84207  0.0  2.7  47520 26280 ?        S    11:07   0:00 uwsgi --ini uwsgi.ini
root       84250  0.0  0.0   6432   720 pts/0    S+   11:08   0:00 grep --color=auto uwsgi
</code></pre>
<h3 id="10-å½»åº•å…³é—­uwsgiè¿›ç¨‹">10. å½»åº•å…³é—­uwsgiè¿›ç¨‹</h3>
<p>å¦‚æœæ²¡æœ‰è®¾ç½®åœæ­¢çš„pidæˆ–è€…å¯åŠ¨å¤±è´¥å¯¼è‡´pidç”Ÿæˆå¤±è´¥ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æœ‰uwgsiè¿›ç¨‹æŒ‚åœ¨åå°ï¼Œå› æ­¤éœ€è¦å½»åº•å…³é—­ï¼š<code>pkill -f uwsgi -9</code></p>
<p>PS.</p>
<ul>
<li>å¦‚æœuwsgiæ—¥å¿—æŠ¥é”™ï¼š<code>uwsgi invalid request block size: 4937 (max 4096)...skip</code><br>
ä»£è¡¨è¯·æ±‚è¿‡å¤§ï¼ˆè¶…è¿‡é»˜è®¤4kï¼‰å› æ­¤è·³è¿‡<br>
å› æ­¤åªè¦å°†è¯·æ±‚æ¥æ”¶çš„å€¼æ–¹æ³•å³å¯ï¼šåœ¨uwsgi.iniæ–‡ä»¶æ·»åŠ <code>buffer-size = 65536</code> å³å¯ã€‚</li>
<li>è¿™æ ·éƒ¨ç½²ä¹‹åï¼Œç½‘ç«™æ˜¯è¯·æ±‚ä¸åˆ°é™æ€æ–‡ä»¶çš„ï¼ˆcss,js,å›¾ç‰‡ç­‰ï¼‰æ‰€ä»¥éœ€è¦å†æ­é…nginxè¿›è¡Œé™æ€æ–‡ä»¶è¯·æ±‚çš„å¤„ç†ã€‚</li>
</ul>
<h2 id="uwsgiå¸¸è§æŠ¥é”™">uwsgiå¸¸è§æŠ¥é”™</h2>
<ul>
<li>
<p>1.å¯åŠ¨å¤±è´¥ï¼š ç«¯å£è¢«å ç”¨<br>
è§£å†³æ–¹æ³•ï¼š æ›´æ¢ç«¯å£/åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹<br>
<code>sudo lsof -i:ç«¯å£å·</code> - æŸ¥çœ‹ç«¯å£  <code>kill -9 ç«¯å£å·</code> - åœæ­¢ç«¯å£è¿›ç¨‹</p>
</li>
<li>
<p>2.åœæ­¢å¤±è´¥ stopæ— æ³•å…³é—­uwsgi<br>
åŸå› ï¼š é‡å¤å¯åŠ¨uwsgiå¯¼è‡´uwsgi.pidä¸­è¿›ç¨‹å·å¤±æ•ˆ<br>
è§£å†³æ–¹æ³• ï¼š ps å‡ºuwsgiè¿›ç¨‹ï¼Œæ‰‹åŠ¨kill</p>
</li>
<li>
<ol start="3">
<li>å¯åŠ¨å¤±è´¥ æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶<br>
å¤§æ¦‚ç‡uwsgi.iniä¸­çš„chdirå’Œwsgiä¸¤ä¸ªå‚æ•°çš„åœ°å€é…ç½®é”™è¯¯<br>
è§£å†³æ–¹æ³•ï¼šä¿®å¤å³å¯ï¼Œæ³¨æ„chdiræ˜¯é¡¹ç›®ç»å¯¹è·¯å¾„ï¼Œwsgiæ˜¯<code>wsgi.py</code>æ–‡ä»¶çš„ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„è·¯å¾„</li>
</ol>
</li>
<li>
<p>å®‰è£…uwsgiæŠ¥é”™<code>ERROR: Failed building wheel for uwsgi</code><br>
æœç´¢è§£å†³æ–¹æ³•ï¼šæ›´æ–°pipå³å¯ -  æ›´æ–°ç³»ç»Ÿä¾èµ– - å®‰è£…psycopg2-binary -<br>
éƒ½æ²¡æœ‰ç”¨<br>
æœ€åï¼š<code>apt-get install build-essential python3-dev</code>ç„¶åpipå³å¯<br>
<a href="https://stackoverflow.com/questions/44037637/error-installing-uwsgi-in-virtualenv">stackoverflow</a></p>
</li>
<li>
<ol start="4">
<li>ä¿®æ”¹é¡¹ç›®åå†ä½¿ç”¨uwsgiå¯åŠ¨æŠ¥é”™</li>
</ol>
</li>
</ul>
<pre><code class="language-python">    raise ImproperlyConfigured(
django.core.exceptions.ImproperlyConfigured: The app module &lt;module 'cyanine' (namespace)&gt; has multiple filesystem locations (['/my/imsys/./cyanine', '/my/imsys/cyanine']); you must configure this app with an AppConfig subclass with a 'path' class attribute.
</code></pre>
<p>åŸå› ï¼šæ²¡æœ‰æ­£ç¡®è®¾ç½®appï¼Œå› ä¸ºæƒ³è¦æ·»åŠ ä¸€ä¸ªå±•ç¤ºé¡µé¢ä½œä¸ºé¡¹ç›®çš„indexï¼Œæ‰€ä»¥å°±ç›´æ¥å°†è¿™ä¸ªhtmlæ–‡ä»¶ä»¥åŠé™„å¸¦çš„é™æ€æ–‡ä»¶ä¸€è‚¡è„‘åœ°æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œé¢ç„¶åæ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œè¿˜åœ¨settingä¸­æ³¨å†Œäº†appåå­—ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªappé‡Œé¢ç¼ºå°‘å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œè¿™å°±å¼€å‘æ¨¡å¼ä¸‹èƒ½å¤Ÿå‡­å€Ÿæ–‡ä»¶è·¯å¾„è¿è¡Œæ­£ç¡®ï¼Œä½†ç”Ÿäº§æ¨¡å¼éƒ¨ç½²çš„æ—¶å€™å°±å¯¼è‡´uwgisè¿è¡Œçš„æ—¶å€™æ‰¾ä¸åˆ°æ–‡ä»¶è·¯å¾„æŠ¥é”™ã€‚<br>
å› æ­¤ï¼Œå¯¹äºdjangoçš„appæ¥è¯´ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>__init.py__</code>å’Œ<code>apps.py</code>æ–‡ä»¶ï¼Œå…¶ä¸­<code>apps.py</code>ä¸­å†…å®¹ä¸º</p>
<pre><code class="language-python">from django.apps import AppConfig
class PollsConfig(AppConfig):
    default_auto_field = &quot;django.db.models.BigAutoField&quot;
    name = &quot;ä½ æ³¨å†Œåœ¨settingä¸­çš„appåå­—&quot;
</code></pre>
<h3 id=""></h3>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[nginx -- å­¦ä¹  -- + uwsgiéƒ¨ç½²djangoé¡¹ç›®]]></title>
        <id>https://cyanineeee.github.io/post/nginx-xue-xi/</id>
        <link href="https://cyanineeee.github.io/post/nginx-xue-xi/">
        </link>
        <updated>2023-07-04T09:36:46.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li><a href="https://www.bilibili.com/video/BV1F5411J7vK/?spm_id_from=333.337.search-card.all.click&amp;vd_source=c66937bc5207a56bafe7811cb2b0c4da">æ•™ç¨‹-8.04å¼€å§‹</a></li>
</ul>
<h3 id="1-ä»€ä¹ˆæ˜¯nginx">1. ä»€ä¹ˆæ˜¯nginx</h3>
<ul>
<li>è½»é‡çº§çš„é«˜æ€§èƒ½3webæœåŠ¡å™¨ï¼Œæä¾›äº†httpä»£ç†å’Œåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ï¼Œä½¿ç”¨cè¯­è¨€ç¼–å†™ï¼Œæ•ˆç‡æé«˜ã€‚</li>
<li>ä¸€èˆ¬ä½¿ç”¨uwsgiåè®®è®©nginxè½¬å‘æ¥æ”¶åˆ°çš„httpåè®®ç»™uWSGIï¼ˆuwsgiåè®®æ˜¯äºŒè¿›åˆ¶ï¼Œæ•ˆç‡æ›´é«˜ï¼‰</li>
</ul>
<h3 id="2-å®‰è£…nginx">2. å®‰è£…nginx</h3>
<p><code>sudo apt install nginx</code><br>
å®‰è£…æˆåŠŸä¹‹åè¾“å…¥<code>nginx -v</code>æŸ¥çœ‹ç‰ˆæœ¬ã€‚<br>
PS. nginxå®‰è£…ä¹‹åä¼šé»˜è®¤å ç”¨80ç«¯å£</p>
<h3 id="3-é…ç½®nginx">3. é…ç½®nginx</h3>
<p><code>/etc/nginx/site-enabled/default</code>æ˜¯nginxçš„é…ç½®æ–‡ä»¶<br>
æ ¸å¿ƒå‚æ•°</p>
<ul>
<li>location / æœ‰ç‚¹åƒè·¯ç”± è¡¨ç¤ºæ‰€æœ‰è¿™ä¸ªè·¯ç”±çš„è¯·æ±‚éƒ½ç”±ä¸‹é¢çš„å‚æ•°ä»£è¡¨çš„æœåŠ¡å¤„ç†</li>
<li>uwsgi_pass å°†æœåŠ¡ä»¥uwsgiä¼ é€’ç»™***åœ°å€ï¼ˆä¾‹å¦‚127.0.0.1:8000ï¼‰</li>
<li>include é…ç½®å‚æ•° å¦‚æœéœ€è¦ä½¿ç”¨uwsgiåè®®éœ€è¦å†™ <code>/etc/nginx/uwsgi_params</code></li>
</ul>
<h3 id="4-å¯åŠ¨åœæ­¢nginx">4. å¯åŠ¨/åœæ­¢nginx</h3>
<p><code>sudo /etc/init.d/nginx start|stop|restart|status</code> åˆ†åˆ«ä»£è¡¨å¯åŠ¨|åœæ­¢|é‡å¯|æŸ¥çœ‹çŠ¶æ€<br>
PS. nginxåªè¦ä¿®æ”¹å°±éœ€è¦é‡å¯ï¼Œå¦åˆ™é…ç½®ä¸ç”Ÿæ•ˆ</p>
<h3 id="5-ä¿®æ”¹uwsgié…ç½®æ–‡ä»¶é€‚é…nginxä¿®æ”¹nginxé€‚é…uwsgiå¯åŠ¨">5. ä¿®æ”¹uwsgié…ç½®æ–‡ä»¶ï¼Œé€‚é…nginxï¼Œä¿®æ”¹nginxï¼Œé€‚é…uwsgiå¯åŠ¨</h3>
<p>å…·ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="language-vim">#defaultæ–‡ä»¶
                # try_files $uri $uri/ =404; #æ³¨é‡Šæ‰è¿™ä¸€å¥
                uwsgi_pass 127.0.0.1:8000;  #æ·»åŠ è¿™ä¸¤å¥
                include /etc/nginx/uwsgi_params;
</code></pre>
<pre><code>#uwsgi.ini
#å»æ‰http ä¿®æ”¹ä¸º socket
socket = 127.0.0.1:8000 #è¿™ä¸ªç«¯å£å·è¦å’Œnginxçš„ä¸€è‡´

</code></pre>
<p>PS. <code>sudo nginx -t</code>å¯ä»¥å¿«é€Ÿæ–¹ä¾¿çš„å‘Šè¯‰ä½ é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯</p>
<h3 id="6-æ’é”™">6. æ’é”™</h3>
<ul>
<li>çœ‹æ—¥å¿—æ–‡ä»¶ï¼ è®¿é—®æ—¥å¿—ï¼š<code>/var/log/nginx/error.log</code> é”™è¯¯æ—¥å¿—ï¼š<code>/var/log/nginx/access.log</code>  å¯¹åº”uwsgiæ—¥å¿— - å’Œ<code>uwsgi.ini</code>åŒçº§ä¸‹çš„<code>uwsgi.log</code></li>
<li>502 ä»£è¡¨nginxåå‘ä»£ç†æˆåŠŸï¼Œä½†æ˜¯å¯¹åº”çš„uwsgiæœªå¯åŠ¨ï¼›è¿˜æœ‰ä¸€ç§å°±æ˜¯uwsgiè®¾ç½®æ¥å—è¯·æ±‚è¿‡å°ï¼Œåœ¨uwsgi.iniä¸­æ·»åŠ <code>buffer-size = 65536</code>  -  ä¸»è¦è¿˜æ˜¯å¾—çœ‹æ—¥å¿—</li>
<li>404ï¼ˆåˆ†ä¸¤ç§ï¼šdjangoæŠ¥é”™/nginxæŠ¥é”™ï¼‰  ä¸€å¯èƒ½æ˜¯è·¯ç”±ä¸åœ¨djangoé¡¹ç›®ï¼›äºŒå¯èƒ½æ˜¯æ²¡æœ‰ç¦æ­¢æ‰nginxé…ç½®æ–‡ä»¶é‡Œçš„<code>try_files</code></li>
</ul>
<h3 id="7-nginxé™æ€æ–‡ä»¶é…ç½®">7. nginxé™æ€æ–‡ä»¶é…ç½®</h3>
<ul>
<li>åˆ›å»ºæ–°æ–‡ä»¶å¤¹ - å­˜æ”¾æ‰€æœ‰çš„djangoé™æ€æ–‡ä»¶ -- ä¾‹å¦‚<code>/home/mysite_static/</code></li>
<li>åœ¨django setting.pyä¸­æ·»åŠ é…ç½® <code>STATIC_ROOT</code>ä»£è¡¨é™æ€æ–‡ä»¶è·¯å¾„  -- ä¾‹å¦‚<code>/home/mysite_static/static/</code></li>
<li>è¿›å…¥djangoé¡¹ç›®ï¼Œæ‰§è¡Œ<code>python3 mange.py collectstatic</code> - æ”¶é›†é¡¹ç›®æ‰€æœ‰çš„é™æ€æ–‡ä»¶</li>
<li>nginxé…ç½®æ–‡ä»¶æ–°å¢åŠ </li>
</ul>
<pre><code class="language-vim">location /static {
root /é™æ€æ–‡ä»¶å¤¹;  
}
</code></pre>
<p>ç‰¹åˆ«è¦æ³¨æ„è·¯å¾„ï¼Œè¿™ä¸ªâ€˜é™æ€æ–‡ä»¶å¤¹â€™ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªstaticçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ‰æ˜¯çœŸæ­£å­˜æ”¾äº†æ‰€æœ‰çš„é™æ€æ–‡ä»¶</p>
<h3 id="8-404500-è‡ªå®šä¹‰æŠ¥é”™é¡µé¢">8. 404/500 è‡ªå®šä¹‰æŠ¥é”™é¡µé¢</h3>
<ul>
<li>åœ¨djangoçš„æ¨¡æ¿æ–‡ä»¶å¤¹å†…æ·»åŠ <code>404.html</code>æ–‡ä»¶ï¼Œå½“è§†å›¾è§¦å‘http404çš„æ—¶å€™è‡ªåŠ¨æ˜¾ç¤ºè¯¥é¡µé¢ï¼ˆåœ¨debug=falseçš„æ—¶å€™å½©èµ·ä½œç”¨ï¼‰ -- æ·»åŠ å®Œä¹‹åè®°å¾—é‡å¯nginxã€uwsgiç­‰æœåŠ¡</li>
</ul>
<h3 id="9-ç»™åŸæ¥çš„é™æ€æ–‡ä»¶å¤¹ä¸‹æ–°å¢æ–‡ä»¶å¤¹ç»“æœ404">9. ç»™åŸæ¥çš„é™æ€æ–‡ä»¶å¤¹ä¸‹æ–°å¢æ–‡ä»¶å¤¹ï¼Œç»“æœ404</h3>
<p>å¤§æ¦‚æ˜¯å› ä¸ºé¡¹ç›®ä¸­çš„é™æ€æ–‡ä»¶è·¯å¾„å’Œnginxçš„æœ‰æ‰€åŒºåˆ«ï¼Œ<br>
éœ€è¦æ³¨æ„aliaså’Œrootçš„åŒºåˆ«ï¼Œ<br>
nginxä¼šæ ¹æ®è¯·æ±‚çš„è·¯å¾„ï¼Œå»è¯·æ±‚é™æ€æ–‡ä»¶å¤¹ä¸­å¯èƒ½å­˜åœ¨çš„ï¼Œæ–‡ä»¶å¤¹ä¸­çš„é™æ€æ–‡ä»¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œnginxæ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä½†æ˜¯å‰ææ˜¯è¯·æ±‚çš„è·¯å¾„éœ€è¦å¯¹åº”çš„ä¸Šã€‚</p>
<h3 id="10-aliasä¸rootçš„åŒºåˆ«">10. aliasä¸rootçš„åŒºåˆ«</h3>
<p><a href="https://blog.csdn.net/m0_58709145/article/details/127754115">csdnå‚è€ƒ</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[djangoå­¦ä¹  -- å‰åç«¯ä¸åˆ†ç¦»çš„ -- part.3 ]]></title>
        <id>https://cyanineeee.github.io/post/django-xue-xi-qian-hou-duan-bu-fen-chi-de-part3/</id>
        <link href="https://cyanineeee.github.io/post/django-xue-xi-qian-hou-duan-bu-fen-chi-de-part3/">
        </link>
        <updated>2023-07-01T13:54:48.000Z</updated>
        <content type="html"><![CDATA[<h3 id="50ajaxè¯·æ±‚">50.ajaxè¯·æ±‚</h3>
<ul>
<li>getè¯·æ±‚</li>
</ul>
<pre><code class="language-js">$.ajax({
    url : 'ä½ çš„url'ï¼Œ
    type : 'get',
    data:{
        ...
        //ä½ çš„æ•°æ® json(k-vå¯¹)
    },
    dataType:'JSON', //å°†è¯·æ±‚é“çš„jsonæ•°æ®è½¬åŒ–ä¸ºjså¯¹è±¡
    success:function(res){ //resæ˜¯è¿”å›å€¼
        //ä½ çš„æ“ä½œ...
    }
})
</code></pre>
<ul>
<li>postè¯·æ±‚</li>
</ul>
<pre><code class="language-js">$.ajax({
    url : 'ä½ çš„url'ï¼Œ
    type : 'post',
    data:{
        ...
        //ä½ çš„æ•°æ® json(k-vå¯¹)
    },
    dataType:'JSON', //å°†è¯·æ±‚é“çš„jsonæ•°æ®è½¬åŒ–ä¸ºjså¯¹è±¡
    success:function(res){ //resæ˜¯è¿”å›å€¼
        //ä½ çš„æ“ä½œ...
    }
})
</code></pre>
<p>å…é™¤scrfçš„è®¤è¯(è¿™æ ·ajaxå°±å¯ä»¥ä¸ç”¨æºå¸¦csrf)</p>
<pre><code class="language-python">from django.views.decorators.csrf import csrf_exempt

@csrf_exempt
def exanple(request):
    #ä½ çš„è§†å›¾å‡½æ•°
</code></pre>
<p>PS. éœ€è¦è®°å¾—ï¼Œajaxè¯·æ±‚çš„urlåœ¨djangoä¸­ä¹Ÿéœ€è¦æ³¨å†Œåœ¨<code>urls.py</code>æ–‡ä»¶ä¸­ã€‚<br>
è¿˜æœ‰ï¼Œajaxè¯·æ±‚åç«¯è¿”å›çš„å¿…é¡»æ˜¯jsonæ ¼å¼ï¼ˆå°±æ˜¯ä½¿ç”¨pythonçš„jsonæ¨¡å—å¯¹å­—å…¸è¿›è¡Œå¤„ç†ï¼ˆdumpsï¼‰ä¸€ä¸‹ï¼‰ï¼›æˆ–è€…djangoä¸­æœ‰<code>JsonResponse</code>å¯ä»¥å­—å…¸æ‰“åŒ…ä¸ºjsonï¼Œä¸ç”¨è‡ªå·±å¤„ç†ã€‚<br>
å¦‚æœjqç›´æ¥é€‰ä¸­è¡¨å•ï¼ˆé€šè¿‡idï¼‰ï¼Œé€šè¿‡<code>serialize()</code>æ–¹æ³•å°±å¯ä»¥è·å–è¡¨å•çš„æ‰€æœ‰æ•°æ®ï¼ˆä¾‹å¦‚<code>$('#form').serialize()</code>ï¼‰ï¼Œä¹‹åajaxå‘é€åˆ°åå°çš„å°±æ˜¯ä¸€æ•´ä¸ªè¡¨å•æ•°æ®(åç«¯é€šè¿‡<code>request.POST</code>è·å–çš„æ˜¯ä¸€ä¸ªå­—å…¸)ã€‚</p>
<h3 id="51æ ¡éªŒajaxæäº¤çš„è¯·æ±‚">51.æ ¡éªŒajaxæäº¤çš„è¯·æ±‚</h3>
<ul>
<li>é€šè¿‡modelform<br>
<a href="https://www.bilibili.com/video/BV1NL41157ph?p=58&amp;vd_source=c66937bc5207a56bafe7811cb2b0c4da">4-12 1:00:50</a><br>
å› ä¸ºajaxæäº¤è¡¨å•æ•°æ®åï¼Œåå°è·å–çš„æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå› æ­¤å¯ä»¥é€šè¿‡modelformçš„dataå®ä¾‹åŒ–ï¼Œç„¶åä½¿ç”¨<code>is_valid()</code>è¿›è¡Œæ ¡éªŒã€‚</li>
</ul>
<h3 id="52formerrorsä¸­åˆ°åº•æ˜¯ä»€ä¹ˆ">52.form.errorsä¸­åˆ°åº•æ˜¯ä»€ä¹ˆ</h3>
<p>æ˜¯ä¸€ä¸ªdjangoä¸­çš„ErrorDictï¼Œå®ƒåŒ…å«ä¸€ä¸ª<code>as_json()</code>æ–¹æ³•ï¼Œå¯ä»¥è‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬å°†å®ƒè½¬åŒ–ä¸ºjsonä¿¡æ¯</p>
<h3 id="53jqä¸­çš„eachå¯ä»¥éå†ç»™å®šçš„å¯¹è±¡">53.jqä¸­çš„<code>$.each()</code>å¯ä»¥éå†ç»™å®šçš„å¯¹è±¡</h3>
<pre><code class="language-js">$.each(å¯¹è±¡,function(key,val ) =&gt; {
//...è¿›è¡Œæ“ä½œï¼Œk,væ˜¯å‡è®¾ä»–æ˜¯ä¸€ä¸ªå­—å…¸å¯¹è±¡ï¼Œå¦‚æœæ˜¯åˆ—è¡¨æˆ–è€…å…¶ä»–çš„å¯è¿­ä»£å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ç»™å‡½æ•°ä¼ å…¥çš„å‚æ•°åšç›¸åº”çš„å˜åŒ–å³å¯
}).
</code></pre>
<h3 id="54jqçš„nextæ–¹æ³•">54.jqçš„<code>.next()</code>æ–¹æ³•</h3>
<p>é€‰æ‹©ç»™å®šå…ƒç´ ç´§é‚»çš„ä¸‹ä¸€ä¸ªå…ƒç´ <br>
<a href="https://www.w3school.com.cn/jquery/traversing_next.asp">è§£é‡Šlink</a></p>
<h3 id="55è®°ä¸æ¸…äº†å¯ä»¥å›é¡¾">55.è®°ä¸æ¸…äº†å¯ä»¥å›é¡¾</h3>
<ul>
<li><a href="https://www.bilibili.com/video/BV1NL41157ph?p=58&amp;vd_source=c66937bc5207a56bafe7811cb2b0c4da">æ­¦æ²›é½-django3æ•™ç¨‹  5-1 </a></li>
</ul>
<h4 id="56jqçš„emptyæ–¹æ³•">56.jqçš„empty()æ–¹æ³•</h4>
<ul>
<li>æ¸…é™¤æ‰€é€‰å…ƒç´ å†…çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹å’Œå­å…ƒç´ <br>
<a href="https://api.jquery.com/empty/">reference_empty()</a></li>
</ul>
<h3 id="57modelformåç«¯è‡ªå®šä¹‰å‚¨å­˜">57.modelformåç«¯è‡ªå®šä¹‰å‚¨å­˜</h3>
<p>å¦‚æœæˆ‘ä»¬è®¾å®šäº†ä¸€ä¸ªè¡¨å•ï¼Œä½†æ˜¯ç”¨æˆ·ä¸èƒ½ä¿®æ”¹ç¼–å·ç­‰éšæœºç”Ÿæˆçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è·å–åˆ°postè¡¨å•ä¿¡æ¯ä¹‹åï¼Œæ‰‹åŠ¨æ·»åŠ ã€‚<br>
å¯¹äºä¸€ä¸ªå®ä¾‹åŒ–ä¹‹åçš„modelformç±»ï¼Œé€šè¿‡<code>modelformexample.instance.è‡ªå®šå±æ€§=</code>æ¥æ·»åŠ ç”¨æˆ·è¾“å…¥æ²¡æœ‰åŒ…å«çš„å­—æ®µã€‚</p>
<h3 id="58modelformæ ¡éªŒç©ºå­—æ®µ">58.modelformæ ¡éªŒç©ºå­—æ®µ</h3>
<ul>
<li>å¦‚æœåœ¨å­—æ®µè®¾ç½®çš„æ—¶å€™æ·»åŠ <code>required = False</code>ï¼Œé‚£ä¹ˆè¡¨å•å­—æ®µå¯ä»¥ä¸ºç©ºï¼Œé»˜è®¤çš„Trueä»£è¡¨è¡¨å•å­—æ®µå¿…é¡»ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šåœ¨æ ¡éªŒä¹‹åæ·»åŠ â€œè¯¥å­—æ®µä¸èƒ½ä¸ºç©ºâ€çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚ä½†æ˜¯è¿™ä¸ªä»…ä»…åªæ˜¯è®©è¡¨å•ä¸éªŒç©ºï¼Œåé¢çš„<code>clean_[å­—æ®µ]</code>è¿˜æ˜¯ä¼šé»˜è®¤æ‰§è¡Œçš„ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªé’©å­å‡½æ•°å°±ç›¸å½“äºä¸è¿›è¡Œæ ¡éªŒï¼‰ã€‚</li>
<li><a href="https://blog.csdn.net/Hackeryuan/article/details/108195456">reference</a><br>
PS. å½“ç„¶ï¼Œå¦‚æœä½ åœ¨å®šä¹‰modelformæˆ–è€…formçš„æ—¶å€™ä¸æ·»åŠ å¯¹åº”çš„å­—æ®µï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ ¡éªŒè¿™ä¸ªå­—æ®µï¼Œç„¶åé€šè¿‡<code>.instance.è‡ªå®šå±æ€§=</code>æ¥è‡ªå®šä¹‰å‚¨å­˜å­—æ®µï¼Œåº”ç”¨ä¾‹å¦‚è®¢å•çš„å®Œæˆäº‹ä»¶ã€è®¢å•çš„ç¼–å·ç­‰ã€‚</li>
<li>formå’Œmodelformçš„æ ¡éªŒä¼šå‘ç”Ÿåœ¨ä¸‰ç§æƒ…å†µä¸‹ï¼šè°ƒç”¨<code>is_valid()</code> ï¼Œè°ƒç”¨<code>.errors</code>è·å–é”™è¯¯ä¿¡æ¯çš„æ—¶å€™è¿˜æœ‰ç›´æ¥è°ƒç”¨<code>full_clean()</code>æ–¹æ³•çš„æ—¶å€™ã€‚</li>
</ul>
<blockquote>
<p>These are normally executed when you call the is_valid() method on a form. There are other things that can also trigger cleaning and validation (accessing the errors attribute or calling full_clean() directly), but normally they wonâ€™t be needed.<br>
<a href="https://docs.djangoproject.com/zh-hans/4.2/ref/forms/validation/">reference_django_official</a></p>
</blockquote>
<h3 id="59-ç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·å½•å…¥åˆ°formè¡¨å•ä¸­ä¸éœ€è¦ç”¨æˆ·å¡«å†™">59. ç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·å½•å…¥åˆ°formè¡¨å•ä¸­ï¼Œä¸éœ€è¦ç”¨æˆ·å¡«å†™</h3>
<p>é€šè¿‡session<br>
<code>request.session['info'][ä¹‹å‰å‚¨å­˜çš„å­—æ®µå±æ€§]</code></p>
<h3 id="60-jqæ¸…ç©ºè¡¨å•è¾“å…¥">60. jqæ¸…ç©ºè¡¨å•è¾“å…¥</h3>
<ul>
<li>é€šè¿‡jqé€‰å–è¡¨å•å…ƒç´ ä¹‹åï¼Œè·å–domå…ƒç´ ï¼Œç„¶åä½¿ç”¨domçš„<code>reset()</code>æ–¹æ³•ç½®ç©ºè¡¨å•ã€‚<br>
<code>$('#è¡¨å•id/é€‰å–è¡¨å•')[0].reset();</code>  jqå¯¹è±¡ -&gt; domå¯¹è±¡ -&gt; ä½¿ç”¨reset()æ–¹æ³•</li>
</ul>
<h3 id="61jqé€‰æ‹©ä¸€ç»„classå¯ä»¥ç›´æ¥ç»‘å®šä¸€ç»„å…ƒç´ çš„äº‹ä»¶">61.jqé€‰æ‹©ä¸€ç»„classå¯ä»¥ç›´æ¥ç»‘å®šä¸€ç»„å…ƒç´ çš„äº‹ä»¶</h3>
<pre><code class="language-js">$('.delete-btn').click(function() {
    $('#delete-modal').modal('show');
})
</code></pre>
<h3 id="62ajaxåˆ é™¤ç¡®è®¤éœ€è¦è®¾ç½®å…¨å±€å˜é‡">62.ajaxåˆ é™¤ç¡®è®¤éœ€è¦è®¾ç½®å…¨å±€å˜é‡</h3>
<p>å› ä¸ºåˆ é™¤åˆ°ç¡®è®¤ä¸­é—´åˆ†æ­¥éª¤ï¼Œéœ€è¦é€šè¿‡å…¨å±€å˜é‡æ¥ä¿è¯æœ€ç»ˆåˆ é™¤çš„å¯ä»¥è·å–åˆ°é€‰æ‹©åˆ°çš„é‚£ä¸€ä¸ªå…ƒç´ ã€‚</p>
<h3 id="63-ajaxçš„getè¯·æ±‚ä¼ é€’æ–¹å¼">63. ajaxçš„getè¯·æ±‚ä¼ é€’æ–¹å¼</h3>
<ul>
<li>ä¸€ç§æ˜¯ç›´æ¥æ‹¼æ¥</li>
</ul>
<pre><code class="language-js">$.ajax({
    url :'login/order/delete/'+nid+'/',  //ç”¨äºåå°æ˜¯é€šè¿‡
     type : 'GET',
     ..
})
</code></pre>
<p>ç”¨äºdjangoåç«¯æ˜¯é€šè¿‡getè¯·æ±‚ç›´æ¥å¤„ç†å‚æ•°çš„è§†å›¾å‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>#urls.py
    path('login/order/delete/&lt;int:id&gt;',views.order_delete,name ='order_delete'), #åˆ é™¤è®¢å•

#views.pyè§†å›¾å‡½æ•°
def order_delete(request,id):
    Orderform.objects.filter(id = id).delete()
    return redirect('/login/order/')
</code></pre>
<ul>
<li>å¦ä¸€ç§ä½¿é€šè¿‡dataå‚æ•°ï¼Œè®©ajaxå¸®åŠ©æ‹¼æ¥urlï¼š</li>
</ul>
<pre><code class="language-js">$.ajax({
        url :'login/order/delete/', 
        type : 'GET',
        data:{
            id:nid,
        },
       ...    // =&gt; æœ€ç»ˆçš„url ï¼š login/order/delete/?id=&quot;nidçš„å€¼&quot;
})
</code></pre>
<p>è¿™æ ·djangoå°±å¯ä»¥é€šè¿‡getè·å¾—urlä¸­çš„å‚æ•°</p>
<pre><code class="language-python">def order_delete(request):
    id = request.GET.get('id')  #éœ€è¦å’Œä¼ å›çš„keyç›¸åŒ
    Orderform.objects.filter(id = id).delete()
    return redirect('/login/order/')
</code></pre>
<h3 id="63å¯¹äºformsæˆ–è€…modelformæ¥è¯´è·å–cleaned_data">63.å¯¹äºformsæˆ–è€…modelformæ¥è¯´è·å–cleaned_data</h3>
<p>å®é™…ä¸Šä¸¤è€…ä»å‰ç«¯çš„requestä¸­è·å–æ–¹å¼æ˜¯é€šè¿‡inputæ¡†çš„nameå±æ€§ï¼Œä¹‹æ‰€ä»¥ç›´æ¥é€šè¿‡è·å–å®šä¹‰å¥½çš„å­—æ®µï¼Œæ˜¯å› ä¸ºåœ¨æ¨¡æ¿ä¸­æ¸²æŸ“çš„æ—¶å€™ç”Ÿæˆçš„inputæ¡†è‡ªå¸¦ä¸€ä¸ªå’Œå­—æ®µä¸€æ ·çš„nameå±æ€§ã€‚æ‰€ä»¥å¦‚æœæ‰“ç®—ä¸ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆå‰ç«¯è¡¨å•ï¼Œé‚£ä¹ˆè·å–è¡¨å•çš„postè¯·æ±‚çš„å…³é”®å­—ï¼Œå°±æ˜¯é€šè¿‡å…¶ä¸­çš„inputçš„nameå±æ€§ï¼ˆæ˜¯é”®å€¼å¯¹ç±»å‹çš„ï¼‰ï¼Œè¿™ä¸ªä¹ŸåŒ…æ‹¬éªŒè¯è¡¨å•ä¸­çš„cleaned_dataã€‚</p>
<h3 id="64-djangoé¡¹ç›®éƒ¨ç½²">64. djangoé¡¹ç›®éƒ¨ç½²</h3>
<p>https://www.zhihu.com/question/348410145</p>
<p>https://pythondjango.cn/django/advanced/16-docker-deployment/</p>
<p>ç¬¬äºŒä¸ª</p>
<h1 id="çœ‹åˆ°5-6-æš‚ä¸”æŠŠé¡¹ç›®åšå®Œéƒ¨ç½²">çœ‹åˆ°5-6 æš‚ä¸”æŠŠé¡¹ç›®åšå®Œéƒ¨ç½²ï¼</h1>
<p>é¡¹ç›®åšå®Œå•¦~ 2023/07/05~ ç»§ç»­è¡¥å……ä¸€ææ</p>
<h3 id="65-è¿‡æ»¤æ•æ„Ÿä¿¡æ¯">65. è¿‡æ»¤æ•æ„Ÿä¿¡æ¯</h3>
<p><a href="https://www.bilibili.com/video/BV1vK4y1o7jH?p=48">bç«™ - 8.06 32:00</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[djangoå­¦ä¹  -- å‰åç«¯ä¸åˆ†ç¦»çš„ -- part.2]]></title>
        <id>https://cyanineeee.github.io/post/django-xue-xi-qian-hou-duan-bu-fen-chi-de-part2/</id>
        <link href="https://cyanineeee.github.io/post/django-xue-xi-qian-hou-duan-bu-fen-chi-de-part2/">
        </link>
        <updated>2023-06-30T12:36:08.000Z</updated>
        <content type="html"><![CDATA[<h3 id="35æ—¶é—´é€‰æ‹©æ’ä»¶">35.æ—¶é—´é€‰æ‹©æ’ä»¶</h3>
<p><a href="https://www.bootcss.com/p/bootstrap-datetimepicker/index.htm">download_link</a><br>
<a href="https://bootstrap-datepicker.readthedocs.io/en/latest/options.html">office_link</a><br>
<a href="https://blog.csdn.net/qq_28633249/article/details/77142352">usage</a></p>
<ul>
<li>ä½¿ç”¨æå…¶ç®€å•ï¼šåªéœ€è¦é€‰æ‹©domç„¶åç»‘å®šå³å¯ï¼Œåœ¨ä½¿ç”¨æ–¹æ³•é‡Œå¯ä»¥è®¾ç½®å„ç§å‚æ•°</li>
</ul>
<pre><code class="language-js">$('#id_presettime').datetimepicker({
   format: 'yyyy-mm-dd hh:ii'
});   
</code></pre>
<h3 id="36modelfieldå®šä¹‰æˆæˆè¡¨å•çš„å±æ€§æ ·å¼">36.modelfieldå®šä¹‰æˆæˆè¡¨å•çš„å±æ€§æ ·å¼</h3>
<pre><code class="language-python">class orderForm(ModelForm):
    class Meta():
        model = Orderform
        fields = &quot;__all__&quot;

    #æ–¹æ³•ä¸€ åŸç”Ÿçš„å±æ€§
    widgets = {
        #ä¸ºhtmlè¡¨å•ä¸­nameç±»å‹çš„inputæ ‡ç­¾æ·»åŠ &quot;class=form-control&quot;
        'name' : forms.TextInput(attrs = {&quot;class&quot; : &quot;form-control&quot;})
        #ä¸ºhtmlè¡¨å•ä¸­passwordç±»å‹çš„inputæ ‡ç­¾æ·»åŠ &quot;class=form-control&quot;
        'password' : formsPasswordInput( attrs = {&quot;class&quot; : &quot;form-control&quot;})
        ...
    }

    #æ–¹æ³•äºŒ æ‰©å†™çˆ¶ç±»å‡½æ•°çš„å±æ€§
        def __init__(self,*arg,**kwargs):
            super().__init__(*arg,**kwargs)
            for name, field in self.fields.items():
                # print(name,field) #è¿™ä¸ªæ˜¯å±•ç¤º self.fields.items()å¯ä»¥ç›´æ¥æ‹¿åˆ°å®šä¹‰åœ¨Metaä¸­çš„fieldså­—æ®µ
                field.widget.attrs = {'class' : 'form-control'} #ä¸ºç”Ÿæˆçš„è¡¨å•inputèµ‹äºˆcsså±æ€§ 
</code></pre>
<ul>
<li>æ‰©å…… è¿™ä¸ªå±æ€§å¯ä»¥ç»§æ‰¿ ä¸è¿‡æš‚æ—¶å¯¹æˆ‘æ²¡ä»€ä¹ˆç”¨å¤„ å› æ­¤passè¿‡</li>
</ul>
<h3 id="37ä¿®æ”¹dajngoçš„modelformç±»çš„inputçš„typeç±»å‹ä¸ºdatetime-local">37.ä¿®æ”¹dajngoçš„modelformç±»çš„<code>input</code>çš„<code>type</code>ç±»å‹ä¸º<code>datetime-local</code></h3>
<ul>
<li>ç¬¬ä¸€ç§æ˜¯é€šè¿‡å‰ç«¯jså®ç°ï¼Œä¸€å…±ä¸‰æ­¥ï¼šç¬¬ä¸€æ‹¿åˆ°åŸå§‹çš„æ—¶é—´æ•°æ®ï¼Œç¬¬äºŒé€‰æ‹©inputæ¡†ç„¶åä¿®æ”¹typeï¼Œç¬¬ä¸‰è®²åŸå§‹çš„æ—¶é—´æ•°æ®ä¿®æ”¹æ ¼å¼ä¹‹ååœ¨èµ‹äºˆç»™inputæ¡†ï¼š</li>
</ul>
<pre><code class="language-js">function changeDatetimeInput(id){
    var time = $(`#${id}`).val().replaceAll('/','-');
    $(`#${id}`).attr('type','datetime-local');
    $(`#${id}`).val(time)
}
changeDatetimeInput('id_presettime');
changeDatetimeInput('id_endtime');
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåç«¯djangoä¼ æ¥çš„ä¹‹é—´ç±»å‹æ˜¯<code>yyyy/mm/dd hh:ii</code>ï¼Œä½†æ˜¯htmlå†…ç½®çš„æ—¶é—´é€‰æ‹©inputæ¡†çš„æ—¶é—´å­—ç¬¦ä¸²æ ¼å¼è¦æ±‚æ˜¯<code>yyyy-mm-ddThh:ii</code>ï¼Œå› æ­¤éœ€è¦å°†åŸæ¥çš„æ–œæ ï¼ˆ/ï¼‰æ›¿æ¢æˆçŸ­æ¨ªï¼ˆ-ï¼‰ï¼Œä¸­é—´Â·çš„<code>T</code>æ˜¯ä¸€ä¸ªæ—¶é—´å­—ç¬¦è¡¨ç¤ºï¼Œå¯ä»¥ç”¨å¤§å†™å­—ç¬¦Tè¡¨ç¤ºï¼Œä½†æœ€ç»ˆè§£æçš„æ—¶å€™ç©ºæ ¼ä¹Ÿå¯ä»¥ï¼Œ<a href="https://blog.csdn.net/jim_LoveQ/article/details/107457771">å…·ä½“å‚è€ƒ</a></p>
<ul>
<li>ç¬¬äºŒç§å°±æ˜¯ä¿®æ”¹djangoçš„<code>DateTimeInput</code><br>
è¿™ç§çœ‹ä¸æ‡‚åŸå› ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯ä»…ä»…ä¿®æ”¹input_typeçš„è¯æ˜¯è§£æä¸äº†çš„ï¼Œå›ç­”ç»™å‡ºçš„åŸå› æ˜¯åç«¯ä¼šå› ä¸ºè¾“å…¥åˆæ³•åˆ¤æ–­å’Œä¸é€šè¿‡ï¼Œ<a href="https://stackoverflow.com/questions/50214773/type-datetime-local-in-django-form">detail_link_and_solution</a></li>
</ul>
<pre><code class="language-python">from django import forms
class DateTimeLocalInput(forms.DateTimeInput):
    input_type = &quot;datetime-local&quot;

class DateTimeLocalField(forms.DateTimeField):
    # Set DATETIME_INPUT_FORMATS here because, if USE_L10N 
    # is True, the locale-dictated format will be applied 
    # instead of settings.DATETIME_INPUT_FORMATS.
    # See also: 
    # https://developer.mozilla.org/en-US/docs/Web/HTML/Date_and_time_formats
    input_formats = [
        &quot;%Y-%m-%dT%H:%M:%S&quot;, 
        &quot;%Y-%m-%dT%H:%M:%S.%f&quot;, 
        &quot;%Y-%m-%dT%H:%M&quot;
    ]
    widget = DateTimeLocalInput(format=&quot;%Y-%m-%dT%H:%M&quot;)
</code></pre>
<p>ç„¶åå†è‡ªå·±çš„modelformä¸­å°†æƒ³è¦ä¿®æ”¹inputçš„typç±»å‹ä¸ºdatetime-localçš„å­—æ®µè®¾ç½®ä¸º<code>DateTimeLocalField</code>å³å¯ï¼š</p>
<pre><code class="language-python">#ç”¨æ³•
class orderEditForm(ModelForm):
    presettime = DateTimeLocalField() #åœ¨è¿™é‡Œå°†æƒ³è¦çš„å­—æ®µè®¾ç½®å³å¯
    class Meta():
        model = Orderform
        fields = &quot;__all__&quot;
</code></pre>
<pre><code class="language-html">&lt;!-- {{field}}ç”Ÿæˆçš„å…·ä½“æ ·å¼  --&gt;
&lt;input type=&quot;text&quot; name=&quot;endtime&quot; value=&quot;1899/12/31 00:00&quot; class=&quot;form-control&quot; id=&quot;id_endtime&quot;&gt;
</code></pre>
<h3 id="38é€šè¿‡validationerroræ¥ä¸ºé’©å­æ–¹æ³•è®¾ç½®éæ³•è¾“å…¥æç¤ºä¿¡æ¯">38.é€šè¿‡validationErroræ¥ä¸ºé’©å­æ–¹æ³•è®¾ç½®éæ³•è¾“å…¥æç¤ºä¿¡æ¯</h3>
<p><code>raise ValidationError</code></p>
<h3 id="39å¯†ç åŠ å¯†-é€šè¿‡é’©å­æ–¹æ³•å®šä¹‰">39.å¯†ç åŠ å¯† é€šè¿‡é’©å­æ–¹æ³•å®šä¹‰</h3>
<ul>
<li>é’©å­æ–¹æ³•è¿”å›çš„å°±æ˜¯å‚¨å­˜åˆ°æ•°æ®åº“ä¸­</li>
<li>md5åŠ å¯† åŠ å¯†éœ€è¦â€œç›â€ï¼Œä¸ºäº†æ–¹ä¾¿å’Œæ•ˆæœ ä½¿ç”¨djangoåœ¨è®¾ç½®ä¸­ç”Ÿæˆçš„secret_keyæ¥å½“ä½œâ€œç›â€</li>
</ul>
<pre><code class="language-python">from django.conf import settings
import hashlib

def md5(data_string):
    obj = hashlib.md5(settings.SECRET_KEY.encode('utf-8'))
    obj.update(data_string.encode('utf-8'))
    return obj.hexdigest()
</code></pre>
<h3 id="40å¯¹äºdjanfoçš„ormå¦‚æœæœç´¢ä¸åˆ°">40.å¯¹äºdjanfoçš„ORMï¼Œå¦‚æœæœç´¢ä¸åˆ°</h3>
<p>æœç´¢ä¸åˆ°å°±è¿”å›Noneï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•è¯·æ±‚</p>
<h3 id="41å¯¹äºè¡¨å•éªŒè¯">41.å¯¹äºè¡¨å•éªŒè¯</h3>
<p>æ‰€æœ‰éªŒè¯é€šè¿‡çš„ä¿¡æ¯éƒ½å‚¨å­˜åœ¨å¯¹åº”çš„<code>cleaned_data</code>ä¸­</p>
<h3 id="42djangoæŠ¥é”™">42.djangoæŠ¥é”™</h3>
<p><code>'Manager' object is not callable</code><br>
åŸå› æ˜¯<code>objects</code>æ˜¯ä¸€ä¸ªå±æ€§è€Œä¸æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå†™æˆ<code>objects()</code>ä¼šæŠ¥è¿™ä¸ªé”™</p>
<h3 id="43ç”¨æˆ·ç™»å½•">43.ç”¨æˆ·ç™»å½•</h3>
<ul>
<li>cookies å’Œ session<br>
æ— çŠ¶æ€çŸ­é“¾æ¥<br>
é€šè¿‡cookiesç»™ç”¨æˆ·å‘æ”¾ä¸€ä¸ªâ€œå‡­è¯â€ï¼Œ ä¿å­˜åœ¨æµè§ˆå™¨ä¸­çš„é”®å€¼å¯¹ï¼Œå‘é€è¯·æ±‚çš„æ—¶å€™è‡ªåŠ¨æºå¸¦<br>
session djangoé»˜è®¤å‚¨å­˜åœ¨mysqlä¸­</li>
</ul>
<p>ä¸šåŠ¡è¿‡ç¨‹ï¼šæ”¶åˆ°ç”¨æˆ·çš„æäº¤ -&gt; æ ¡éªŒï¼ˆåœ¨æ•°æ®åº“æ¯”è¾ƒï¼‰ -&gt; æˆåŠŸ ç”Ÿæˆéšæœºå­—ç¬¦ä¸²å†™å…¥åˆ°ç”¨æˆ·æµè§ˆå™¨çš„cookiesä»¥åŠæ•°æ®åº“ä¸­ï¼ˆè¿™é‡Œåªéœ€è¦è°ƒç”¨<code>request.session()</code>æ–¹æ³•å³å¯ djangoä¼šè‡ªåŠ¨å¤„ç†ä¸¤ä¸ªäº‹ä»¶ï¼‰ï¼Œå¹¶ä¸”ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ç»è¿‡å¤„ç†ä¹‹åï¼Œä»¥<code>{session_key:session_data}</code>é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä¸­session_keyå°±æ˜¯ä¼ é€’ç»™æµè§ˆå™¨çš„cookiesï¼Œè€Œsession_dataå°±æ˜¯åœ¨ä¸‹é¢ä»£ç ä¸­å®šä¹‰çš„å­—å…¸ï¼ˆç»è¿‡å­—ç¬¦è½¬æ¢ï¼Œéœ€è¦ä½¿ç”¨çš„æ—¶å€™djangoä¼šè§£ç ï¼‰</p>
<pre><code class="language-python">        else: #ç™»é™†æˆåŠŸ
            request.session['info'] = { #å†™å…¥session
                'id':login_object.id,
                'name' : login_object.name,
            }
</code></pre>
<ul>
<li>
<p style="color:red;font-size:large;">PS. ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åé¢çš„è°ƒç”¨request.sessionä¸­çš„å±æ€§çš„åå­—éƒ½æ˜¯æ¥è‡ªäºæ­¤ï¼</p>
</li>
</ul>
<p>å› æ­¤éœ€è¦åœ¨ç”¨æˆ·è®¿é—®çš„æ—¶å€™åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½• -&gt; å·²ç™»å½•ç»§ç»­è®¿é—® æœªç™»å½•è·³è½¬å›ç™»é™†é¡µé¢ï¼š<br>
ç”¨æˆ·è¯·æ±‚-&gt; æ‹¿åˆ°ç”¨æˆ·cookieså¹¶åˆ¤æ–­ï¼š</p>
<pre><code class="language-python">#ç¬¬ä¸€ç§æ–¹æ³• åœ¨æ¯ä¸ªè¯·æ±‚å‰éƒ½åŠ ä¸Šå¯¹äºcookiesçš„åˆ¤æ–­
    if not request.session.get('info'):
        return redirect('/login/')
</code></pre>
<p>å¤ªlowğŸ˜<br>
åº”è¯¥ä½¿ç”¨djangoçš„ä¸­é—´ä»¶é«˜æ•ˆçš„å¤„ç†</p>
<h3 id="44djangoä¸­é—´ä»¶">44.djangoä¸­é—´ä»¶</h3>
<p><a href="https://docs.djangoproject.com/zh-hans/4.1/topics/http/middleware/">å®˜æ–¹æ–‡æ¡£</a></p>
<ul>
<li>å¯¹äºdjangoï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½éœ€è¦ç»è¿‡å¾ˆå¤šä¸­é—´ä»¶ä¹‹åæ‰èƒ½è®¿é—®åˆ°è§†å›¾å‡½æ•°ï¼›åŒæ ·çš„ï¼Œæ‰€æœ‰çš„è§†å›¾å‡½æ•°è¿”å›å€¼éƒ½éœ€è¦ç»è¿‡å¾ˆå¤šä¸­é—´ä»¶çš„å¤„ç†æ‰ä¼šè¿”å›ç»™ç”¨æˆ·ã€‚</li>
<li>djangoçš„ä¸­é—´ä»¶éƒ½æ˜¯ç±»ï¼Œé€šè¿‡<code>process_request</code>æ–¹æ³•å¯¹ä¼ å…¥çš„è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡<code>process_response</code>å¯¹è§†å›¾å‡½æ•°çš„returnè¿›è¡ŒåŒ…è£…ã€‚å¦‚æœæŸä¸ªè¯·æ±‚ä¸èƒ½é€šè¿‡ä¸€ä¸ªä¸­é—´ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œè€Œä¸ä¼šåˆ°è¾¾è§†å›¾å‡½æ•°ã€‚</li>
<li>ä¸­é—´ä»¶å†™å¥½ä¹‹åéœ€è¦åœ¨setting.pyæ–‡ä»¶ä¸­çš„MIDDLEWAREä¸­æ³¨å†Œï¼ˆå…·ä½“åˆ°ç±»åï¼‰ï¼Œå“ªä¸ªåœ¨å‰é¢é‚£ä¸ªå…ˆæ‰§è¡Œã€‚</li>
<li>ä¸­é—´çš„<code>process_request</code>æ–¹æ³•å¦‚æœè¿”å›ä¸ºNoneï¼Œé‚£ä¹ˆç»§ç»­å‘åæ‰§è¡Œï¼›å¦‚æœéœ€è¦è¿”å›ï¼Œé‚£ä¹ˆè¿”å›çš„ç±»å‹ä¸è§†å›¾å‡½æ•°çš„è¿”å›ç±»ä¼¼ï¼ˆä¾‹å¦‚render,redirect,HttpResponseç­‰ï¼‰ï¼Œå¹¶ä¸”ä¸åœ¨å‘åæ‰§è¡Œã€‚</li>
<li>åº”ç”¨ä¸­é—´ä»¶ï¼š
<ul>
<li>1.æ³¨å†Œä¸­é—´ä»¶</li>
<li>2.ä¸­é—´ä»¶ä¸­è¿”å›å€¼</li>
<li>3.é€šè¿‡ä¸­é—´ä»¶å®ç°ç™»å½•æ ¡éªŒ<br>
ä»£ç å®ç°</li>
</ul>
</li>
</ul>
<pre><code class="language-python">#middleware.pyæ–‡ä»¶
from django.utils.deprecation import MiddlewareMixin
from django.shortcuts import render,redirect
from django.http import HttpResponse

class SessionChectMiddleware(MiddlewareMixin):
    def process_request(self,request):
        #æ’é™¤ä¸éœ€è¦ç™»é™†çš„é¡µé¢
        allow_url = ['/login/','/register/']
        if request.path_info in allow_url:
            return
        #è¯»å–session
        info = request.session.get('info')
        if info:
            return
        else: 
            return redirect('/login/')
</code></pre>
<pre><code class="language-python">#åœ¨setting.pyæ–‡ä»¶ä¸­æ³¨å†Œ
MIDDLEWARE = [
    &quot;django.middleware.security.SecurityMiddleware&quot;,
...... ,
    &quot;cake.middleware.SessionChectMiddleware&quot;,
]
</code></pre>
<p>PS. request.path_infoå¯ä»¥è·å–åˆ°è¯·æ±‚çš„urlè·¯å¾„ã€‚</p>
<h3 id="45æ³¨é”€æ“ä½œ-ç”¨æˆ·é€€å‡ºç™»å½•">45.æ³¨é”€æ“ä½œ - ç”¨æˆ·é€€å‡ºç™»å½•</h3>
<p>ä¹Ÿå°±æ˜¯å°†æµè§ˆå™¨çš„cookieså’Œsessionåˆ é™¤<br>
åŒæ ·ä½¿ç”¨request.sessionä¸­çš„æ–¹æ³•å³å¯</p>
<h3 id="46é€šè¿‡sessionè·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯æ˜¾ç¤ºåœ¨å¯¼èˆªæ ">46.é€šè¿‡sessionè·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯æ˜¾ç¤ºåœ¨å¯¼èˆªæ </h3>
<p>æ¯æ¬¡è§†å›¾å‡½æ•°çš„ä¸­ä¼ é€’çš„requestä¸­éƒ½åŒ…å«sessionå‚æ•°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­è°ƒç”¨<code>{{request.session.info.å±æ€§}}</code>æ¥è·å–å¯¹åº”çš„ä¿¡æ¯ï¼ˆå› ä¸ºrequestæ˜¯é»˜è®¤ä¼ é€’çš„ï¼‰ï¼Œä¸ç”¨åˆ»æ„é€šè¿‡åˆ«çš„æ¨¡æ¿å‚æ•°æ¥æ¸²æŸ“ã€‚</p>
<pre><code class="language-python">    &lt;button class=&quot;btn btn-secondary dropdown-toggle btn-sm&quot; type=&quot;button&quot; id=&quot;dropdownMenuButton2&quot; data-bs-toggle=&quot;dropdown&quot; aria-expanded=&quot;false&quot;&gt;
                        {{ request.session.info.name}}
&lt;/button&gt;
</code></pre>
<h3 id="47formå’Œmodelform">47.formå’Œmodelform</h3>
<ul>
<li>formå¯ä»¥è‡ªå®šä¹‰å­—æ®µ<br>
modeformæ—¢å¯ä»¥è‡ªå®šä¹‰ è¿˜å¯ä»¥åœ¨æ•°æ®åº“ä¸­æ‹¿å–å­—æ®µ</li>
<li>formæ²¡æœ‰saveæ–¹æ³•å¯ä»¥ç›´æ¥å­˜å…¥åˆ°æ•°æ®åº“ ä½†æ˜¯modelformæœ‰</li>
</ul>
<h3 id="48å›¾ç‰‡éªŒè¯ç ">48.å›¾ç‰‡éªŒè¯ç </h3>
<p>-&gt; pythonä¸­å¦‚ä½•åŠ¨æ€ç”Ÿæˆå›¾ç‰‡å¹¶å†™å…¥å€¼ (ä¸åšè¿‡å¤šäº†è§£ ä»…ä»…å½“æˆé»‘ç›’ä½¿ç”¨)<br>
<a href="https://www.cnblogs.com/crischou/p/7152974.html">å‚è€ƒæ–‡çŒ®</a></p>
<ul>
<li>éœ€è¦pillowåº“</li>
</ul>
<pre><code class="language-python">import random
from PIL import Image,ImageFont,ImageDraw,ImageFilter
#éœ€è¦æ³¨æ„ï¼ï¼ è¿™é‡Œçš„å­—ä½“æ–‡ä»¶font_fileè·¯å¾„ç»„åˆæ˜¯åŸºäºè¿è¡Œçš„æ ¹ç›®å½•å†³å®šçš„ éœ€è¦æ ¹æ®ç›¸å¯¹ä½ç½®çš„ä¸åŒè¿›è¡Œè°ƒæ•´ï¼è¿™é‡Œæˆ‘å°†ä»–æ”¾åœ¨æ ¹ç›®å½•ä¸‹é¢çš„static/æ–‡ä»¶å¤¹å†…
def check_code(width=120, height=30, char_length=5, font_file='./static/kumo.ttf', font_size=28):
    # font = ImageFont.load_default() #ä½¿ç”¨é»˜è®¤å­—ä½“
    code = []
    img = Image.new(mode='RGB', size=(width, height), color=(255, 255, 255))
    draw = ImageDraw.Draw(img, mode='RGB')
    def rndChar():
        &quot;&quot;&quot;
        ç”Ÿæˆéšæœºå­—æ¯   
        :return:
        &quot;&quot;&quot;
        return chr(random.randint(65, 90))
    def rndColor():
        &quot;&quot;&quot;
        ç”Ÿæˆéšæœºé¢œè‰²
        :return:
        &quot;&quot;&quot;
        return (random.randint(0, 255), random.randint(10, 255), random.randint(64, 255))
    # å†™æ–‡å­—
    font = ImageFont.truetype(font_file, font_size)
    for i in range(char_length):
        char = rndChar()
        code.append(char)
        h = random.randint(0, 4)
        draw.text([i * width / char_length, h], char, font=font, fill=rndColor())
    # å†™å¹²æ‰°ç‚¹
    for i in range(40):
        draw.point([random.randint(0, width), random.randint(0, height)], fill=rndColor())
    # å†™å¹²æ‰°åœ†åœˆ
    for i in range(40):
        draw.point([random.randint(0, width), random.randint(0, height)], fill=rndColor())
        x = random.randint(0, width)
        y = random.randint(0, height)
        draw.arc((x, y, x + 4, y + 4), 0, 90, fill=rndColor())
    # ç”»å¹²æ‰°çº¿
    for i in range(5):
        x1 = random.randint(0, width)
        y1 = random.randint(0, height)
        x2 = random.randint(0, width)
        y2 = random.randint(0, height)

        draw.line((x1, y1, x2, y2), fill=rndColor())

    img = img.filter(ImageFilter.EDGE_ENHANCE_MORE)
    return img,''.join(code)
 
if __name__ == '__main__':
    # 1. ç›´æ¥æ‰“å¼€
    # img,code = check_code()
    # img.show()
 
    # 2. å†™å…¥æ–‡ä»¶
    img,code = check_code()
    with open('code.png','wb') as f:
        img.save(f,format='png')
 
    # 3. å†™å…¥å†…å­˜(Python3)
    # from io import BytesIO
    # stream = BytesIO()
    # img.save(stream, 'png')
    # stream.getvalue()
 
    # 4. å†™å…¥å†…å­˜ï¼ˆPython2ï¼‰
    # import StringIO
    # stream = StringIO.StringIO()
    # img.save(stream, 'png')
    # stream.getvalue()

    pass
</code></pre>
<p style='color:red'>éœ€è¦æ³¨æ„ï¼ï¼`check_code()`çš„å­—ä½“æ–‡ä»¶`font_file`è·¯å¾„ç»„åˆæ˜¯åŸºäºè¿è¡Œçš„æ ¹ç›®å½•å†³å®šçš„ éœ€è¦æ ¹æ®ç›¸å¯¹ä½ç½®çš„ä¸åŒè¿›è¡Œè°ƒæ•´ï¼è¿™é‡Œæˆ‘å°†ä»–æ”¾åœ¨æ ¹ç›®å½•ä¸‹é¢çš„`static/`æ–‡ä»¶å¤¹å†…</p>
+ ç„¶åå°±æ˜¯éƒ¨ç½²åˆ°djangä¸­ï¼šä¸»è¦æ˜¯å°†å‰ç«¯è¯·æ±‚å›¾ç‰‡çš„urlæ›¿æ¢ä¸ºåŠ¨æ€çš„ï¼Œç„¶åç”ŸæˆéªŒè¯ç çš„è§†å›¾å‡½æ•°è¿”å›å¯¹åº”çš„éªŒè¯ç å›¾ç‰‡ã€‚
```python
from .function.checkcode import check_code #è¿™ä¸ªå°±æ˜¯åˆšæ‰çš„ç”ŸæˆéªŒè¯ç å›¾ç‰‡çš„å‡½æ•°
from io import BytesIO #å°†å›¾ç‰‡å‚¨å­˜åˆ°å†…å­˜ä¸­éœ€è¦ç”¨çš„åº“
<p>def image_code(request):<br>
'''ç”ŸæˆéªŒè¯ç '''<br>
img,str = check_code()<br>
print(str)<br>
stream = BytesIO()<br>
img.save(stream, 'png')</p>
<pre><code>return HttpResponse(stream.getvalue()) #ä»å†…å­˜ä¸­è¯»å–åˆ°å›¾ç‰‡ç„¶åä»¥http responseçš„å½¢å¼ä¼ å›ç»™å‰ç«¯ å‰ç«¯çš„imgæ ‡ç­¾è§£æä¹‹åå°±æ˜¯ä¸€ä¸ªå›¾ç‰‡
</code></pre>
<pre><code>```html
&lt;img src=&quot;/image/code/&quot;&gt; 
&lt;!-- åªè¦è°ƒç”¨å¯¹åº”çš„urlå°±å¯ä»¥ --&gt;

</code></pre>
<p>PS. éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåŒä¸€ä¸ªæ–‡ä»¶ä¸­ä¸è¦å‡ºç°åå­—ç›¸åŒçš„å‡½æ•°ï¼Œä¸ç®¡æ˜¯å¼•ç”¨çš„è¿˜æ˜¯æœ¬æ–‡ä»¶çš„ï¼Œä¼šå¯¼è‡´è°ƒç”¨å‡ºé”™</p>
<h3 id="49å¦‚ä½•éªŒè¯éªŒè¯ç å‘¢">49.å¦‚ä½•éªŒè¯éªŒè¯ç å‘¢ï¼Ÿ</h3>
<p>é€šè¿‡sessionï¼ - è¿™æ ·æ¯ä¸ªç”¨æˆ·åœ¨ç™»é™†çš„æ—¶å€™å¯¹äºéªŒè¯ç çš„éªŒè¯å°±ä¸ä¼šå—åˆ°å¹²æ‰°ï¼Œå¹¶ä¸”é‡å¤åˆ·æ–°ä¹Ÿä¼šæ›´æ–°sessionä¸­å¯¹åº”çš„éªŒè¯ç ã€‚<br>
è¿™é‡Œæœ‰å¾ˆå¤šéœ€è¦æ³¨æ„çš„ç‚¹ï¼</p>
<ul>
<li><code>add_errors()</code>å¯ä»¥å‘formsä¸­æŒ‡å®šå­—æ®µæ·»åŠ é”™è¯¯æç¤ºä¿¡æ¯ï¼Œç„¶åèƒ½åœ¨å‰ç«¯çš„<code>{{fields.å±æ€§å­—æ®µ.errors.0}}</code>ä¸­å–åˆ°ã€‚</li>
<li>ç”±äºéªŒè¯ç çš„å­—æ®µæ˜¯æ²¡æœ‰åœ¨ç”¨æˆ·model/æ•°æ®åº“è¡¨ä¸­å­˜åœ¨çš„ï¼Œå› æ­¤å¦‚æœç›´æ¥ä¼ å…¥<code>request.POST</code>ä½œä¸ºdataå‚æ•°ä¼šæŠ¥é”™ã€‚å› æ­¤åº”è¯¥å°†éªŒè¯ç å­—æ®µå•ç‹¬å‰”é™¤ã€‚</li>
<li>éªŒè¯ç éªŒè¯éœ€è¦è°ƒç”¨ä¹‹å‰åˆ›å»ºéªŒè¯ç æ—¶å­˜å…¥sessionçš„å­—æ®µï¼Œå°†ä¸¤ä¸ªå­—æ®µç›¸æ¯”è¾ƒåˆ¤æ–­æ˜¯å¦æ­£ç¡®ã€‚</li>
<li>ç™»å½•æˆåŠŸä¹‹åéœ€è¦é‡æ–°è®¾ç½®sessionçš„è¿‡æœŸæ—¶é—´ ï¼Œå› ä¸ºä¸ºäº†éªŒè¯ç çš„ç™»å½•æ—¶æ•ˆï¼Œåœ¨ç”ŸæˆéªŒè¯ç çš„æ—¶å€™ä¼šè®¾ç½®ä¿å­˜éªŒè¯ç å¯¹æ¯”å­—æ®µçš„sessionä¿¡æ¯æ—¶æ•ˆæ¯”è¾ƒçŸ­ï¼Œå› æ­¤ç™»å½•æˆåŠŸä¹‹åéœ€è¦é‡æ–°è®¾ç½®ã€‚<br>
æœ€ç»ˆçš„ç™»å½•é€»è¾‘</li>
</ul>
<pre><code class="language-python">from .models import UserInfo #modelä¸­çš„ç±» æ˜¯æœ€åŸæœ¬çš„ç”¨æˆ·ä¿¡æ¯ç±» åŒ…æ‹¬è´¦æˆ·åå’Œå¯†ç ä»¥åŠè‡ªåŠ¨ç”Ÿæˆçš„id
from io import BytesIO #ç”Ÿæˆå›¾ç‰‡å‚¨å­˜åœ¨å†…å­˜
from .encrypt import md5 #åŠ å¯†

class loginForm(forms.Form):
    name = forms.CharField(label='ç”¨æˆ·å',widget=forms.TextInput(
        attrs = {
            'class' :&quot;my-input-item&quot;
        }
    ))
    password = forms.CharField(label='å¯†ç ',widget=forms.PasswordInput(
        attrs = {
            'class' :&quot;my-input-item&quot;
        }
    ))
    code = forms.CharField(label='éªŒè¯ç ',widget=forms.TextInput(
        attrs={
            'class':&quot;my-input-item&quot; ,
            'style':&quot;margin-top:0;&quot; ,
            'placeholder':&quot;éªŒè¯ç &quot;
        }
    ),required=True)

    def cleaned_password(self):
        return md5(self.changed_data.get('password')) #md5åŠ å¯†

#ç™»å½•é¡µé¢ 
def login(request):
    if request.method == 'GET':
        form = loginForm()
        return render(request,'login.html',{
            'form':form
        })

    login_form = loginForm(data=request.POST)
    if login_form.is_valid():
        user_input_code = login_form.cleaned_data.pop('code') 
        #éªŒè¯ç çš„æ ¡éªŒ
        code = request.session.get('image_code','') #è¿™ä¸ªæ˜¯åœ¨ç”ŸæˆéªŒè¯ç çš„æ—¶å€™å­˜å…¥sessionä¸­çš„ï¼Œå¦‚æœè¿‡æ—¶æˆ–è€…è·å–ä¸åˆ°é»˜è®¤ä¸ºç©º
        if code.upper() != user_input_code.upper(): #ä¸è€ƒè™‘å¤§å°å†™ 
            #å¦‚æœéªŒè¯ç ä¸ç›¸ç­‰
            login_form.add_error('code','éªŒè¯ç é”™è¯¯')
            return render(request,'login.html',{
                'form' : login_form,
            })

        login_object = UserInfo.objects.filter(**login_form.cleaned_data).first() #æ ¡éªŒç”¨æˆ·å¯†ç 
        if not login_object:
            login_form.add_error('name','ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
            return render(request,'login.html',{
                'form' : login_form,
            })
        else: #ç™»é™†æˆåŠŸ
            request.session['info'] = { #å†™å…¥session
                'id':login_object.id,
                'name' : login_object.name,
            }
            request.session.set_expiry(60 * 60 * 24 * 7) #å†é‡æ–°è®¾ç½®session ä¿å­˜7å¤©
            return redirect('/login/manage/')
    else: #è¡¨å•éªŒè¯æœªé€šè¿‡
        return render(request,'login.html',{
                'form' : login_form,
            }) 

#ç”ŸæˆéªŒè¯ç 
def image_code(request):
    '''ç”ŸæˆéªŒè¯ç '''
    img,str = check_code()
    request.session['image_code'] = str
    request.session.set_expiry(60) #è®¾ç½®éªŒè¯ç session 60sè¿‡æ—¶
    stream = BytesIO()
    img.save(stream, 'png')
    return HttpResponse(stream.getvalue())
</code></pre>
<p>PS. UserInfoæ˜¯åœ¨model.pyæ–‡ä»¶ä¸­çš„ORMç±»ï¼Œå¯¹åº”ç€å‚¨å­˜ç™»å½•ç”¨æˆ·å¸å·å¯†ç çš„æ•°æ®åº“è¡¨ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[mysql -- nullå’Œç©ºçš„åŒºåˆ«]]></title>
        <id>https://cyanineeee.github.io/post/mysql-null-he-kong-de-qu-bie/</id>
        <link href="https://cyanineeee.github.io/post/mysql-null-he-kong-de-qu-bie/">
        </link>
        <updated>2023-06-29T14:14:27.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>ç©ºå€¼æ—¶ä¸å ç”¨ç©ºé—´çš„ï¼› 2ã€nullå…¶å®æ˜¯å ç”¨ç©ºé—´çš„ï¼› æ‰“ä¸ªæ¯”æ–¹æ¥è¯´ï¼Œä½ æœ‰ä¸€ä¸ªæ¯å­ï¼Œç©ºå€¼ä»£è¡¨æ¯å­æ˜¯çœŸç©ºçš„ï¼ŒNULLä»£è¡¨æ¯å­ä¸­è£…æ»¡äº†ç©ºæ°”ï¼Œè™½ç„¶æ¯å­çœ‹èµ·æ¥éƒ½æ˜¯ç©ºçš„ï¼Œä½†æ˜¯åŒºåˆ«æ˜¯å¾ˆå¤§çš„ã€‚ NULL å…¶å®å¹¶ä¸æ˜¯ç©ºå€¼ï¼Œè€Œæ˜¯è¦å ç”¨ç©ºé—´ï¼Œæ‰€ä»¥mysqlåœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼ŒNULL ä¼šå‚ä¸å­—æ®µæ¯”è¾ƒï¼Œæ‰€ä»¥å¯¹æ•ˆç‡æœ‰ä¸€éƒ¨åˆ†å½±å“</p>
</blockquote>
<ul>
<li><a href="https://blog.51cto.com/u_3303362/3795308">nullå’Œç©ºçš„åŒºåˆ«</a></li>
</ul>
<p>é‚£ä»€ä¹ˆæ—¶å€™ç”¨nullä»€ä¹ˆæ—¶å€™ç”¨ç©ºå€¼å‘¢ï¼Ÿ</p>
<blockquote>
<p>æ›´æ¨èä½¿ç”¨ç©ºå€¼ã€‚ä¸¤è€…çš„å«ä¹‰ä¸ä¸€æ ·ï¼Œå‰è€…ä»£è¡¨ä¸æ¸…æ¥šï¼Œåè€…ä»£è¡¨ç¼ºå¤±å€¼ã€‚ä½†å®é™…ä½¿ç”¨ä¸Šnullä¼šåœ¨æ•°æ®åº“æ“ä½œæ–¹é¢é€ æˆå¾ˆå¤šçš„éº»çƒ¦ï¼Œå› æ­¤æ›´æ¨èè®¾ç½®ä¸ºç©ºå€¼ï¼Œå¹¶ä¸”å­—æ®µè®¾ç½®ä¸º<code>NOT NULL</code></p>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[djangoå­¦ä¹  -- å¯ä»¥æ„Ÿå—åˆ°æœ€åŸå§‹çš„djangoæ¡†æ¶æ˜¯å‰åç«¯ä¸åˆ†ç¦»çš„ -- part.1]]></title>
        <id>https://cyanineeee.github.io/post/lin-shi-ji-lu/</id>
        <link href="https://cyanineeee.github.io/post/lin-shi-ji-lu/">
        </link>
        <updated>2023-06-26T16:21:01.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li>
<h2 id="å­¦ä¹ è§†é¢‘"><strong><a href="https://www.bilibili.com/video/BV1NL41157ph/?p=45&amp;spm_id_from=pageDriver&amp;vd_source=c66937bc5207a56bafe7811cb2b0c4da">å­¦ä¹ è§†é¢‘</a></strong></h2>
</li>
</ul>
<h3 id="1è¯·æ±‚å’Œå“åº”">1.è¯·æ±‚å’Œå“åº”</h3>
<ul>
<li>get post redirect</li>
</ul>
<h3 id="2æ•°æ®åº“æ“ä½œ">2.æ•°æ®åº“æ“ä½œ</h3>
<ul>
<li>mysql+pymsql</li>
<li>ORMæ¡†æ¶ -&gt; å¸®åŠ©æˆ‘ä»¬å¤„ç†sqlè¯­å¥ =&gt; pip install mysqlclient<br>
åˆ›å»ºä¿®æ”¹åˆ é™¤æ•°æ®ä¸­çš„è¡¨ï¼ˆä¸ç”¨å†™sqlè¯­å¥ï¼‰<br>
æ“ä½œè¡¨ä¸­çš„æ•°æ®<br>
=&gt; åˆ›å»ºæ•°æ®åº“ djangoè¿æ¥æ•°æ®<br>
PS. éœ€è¦åœ¨setting.pyè¿›è¡Œè®¾ç½®</li>
</ul>
<h3 id="3è®©djangoå¸®åŠ©åˆ›å»ºæ•°æ®åº“è¡¨">3.è®©djangoå¸®åŠ©åˆ›å»ºæ•°æ®åº“è¡¨</h3>
<ul>
<li>djangoä¼šé€šè¿‡modelä¸­çš„ç±»å¸®åŠ©ç”Ÿæˆsqlåˆ›å»ºè¡¨å’Œå­—æ®µ<br>
ç±»åä»£è¡¨è¡¨æ˜ å±æ€§ä»£è¡¨åˆ—å</li>
</ul>
<pre><code class="language-python">class UserInfo(models.Model):
    name = models.CharField(max_length=32)
    password = models.CharField(max_length=64)
</code></pre>
<h3 id="4æ‰§è¡Œå‘½ä»¤">4.æ‰§è¡Œå‘½ä»¤</h3>
<ul>
<li>éœ€è¦æå‰æ³¨å†Œapp -&gt; åœ¨setting.pyä¸­æ³¨å†Œ<br>
python manage.py makemigrations<br>
python manage.py migrate</li>
</ul>
<h3 id="5éœ€è¦æ³¨æ„">5.éœ€è¦æ³¨æ„</h3>
<ul>
<li>åœ¨å·²ç»æœ‰çš„modelç±»ä¸­æ·»åŠ å±æ€§ å¯èƒ½ä¼šå¯¼è‡´åŸæ¥å·²ç»æœ‰çš„æ•°æ®ç¼ºå¤±æ–°å¢åŠ çš„åˆ—çš„æ•°æ®<br>
djangoç»™å‡ºäº†ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€æ˜¯åœ¨å‘½ä»¤è¡Œä¸­é»˜è®¤æ·»åŠ è¾“å…¥ï¼ŒäºŒæ˜¯åœ¨æ–°å¢åŠ çš„å±æ€§å­—æ®µä¸­å¢åŠ  <code>default=</code>å­—æ®µï¼Œä»£è¡¨ç»™åŸæ¥æ²¡æœ‰çš„ç¼ºå¤±å€¼èµ‹å€¼ã€‚ä¾‹å¦‚ï¼š<br>
<code>age = models.CharField(defalut=18)</code><br>
æˆ–è€…è®¾ç½®å¯ä»¥ä¸ºç©º<br>
<code>age = models.CharField(null=True,blank=True)</code></li>
</ul>
<h3 id="6é€šè¿‡djangoå‘è¡¨ä¸­æ’å…¥æ•°æ®">6.é€šè¿‡djangoå‘è¡¨ä¸­æ’å…¥æ•°æ®</h3>
<ul>
<li>
<p><code>UserInfo.objects.create(name='cyanine',password=&quot;123456&quot;)</code> æ’å…¥æ•°æ® éœ€è¦ç±»ä¸­çš„å±æ€§å¯¹åº”<br>
<code>a = UserInfo.objects.all()</code>è·å–æ‰€æœ‰æ•°æ® ä»¥åˆ—è¡¨è¿”å›ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ é€šè¿‡<code>.å±æ€§</code>è·å–å…·ä½“çš„æ•°æ®<code>a.name</code>ï¼Œç»“åˆ<code>.filter()</code>å¯ä»¥è¿›è¡Œç­›é€‰æŸ¥è¯¢<br>
<code>.first()</code>è·å–è·å–åˆ°çš„ç¬¬ä¸€ä¸ªå¯¹è±¡</p>
</li>
<li>
<p>åˆ é™¤æ•°æ®<br>
<code>.delete()</code><br>
å¯ä»¥æ·»åŠ <code>filter</code>è¿›è¡Œç­›é€‰ ä¾‹å¦‚<code>UserInfo.objects.filter(name='cyanine').delete()</code> åˆ é™¤æ‰€æœ‰nameä¸ºcyanineçš„æ•°æ®<br>
ä½¿ç”¨<code>.all()</code>é€‰æ‹©å…¨éƒ¨<code>UserInfo.objects.all().delete()</code>åˆ é™¤è¿™å¼ è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®</p>
</li>
<li>
<p>æ›´æ–°æ•°æ®<br>
<code>UserInfo.objects.all().updata(password=123456)</code>æ›´æ–°æ‰€æœ‰çš„passwordä¸º123456<br>
è¿˜å¯ä»¥ç»“åˆ<code>.filter()</code>è¿›è¡Œç­›é€‰</p>
</li>
</ul>
<h3 id="7djangoè¡¨å•å¦‚æœä¸å†™action-é‚£ä¹ˆé»˜è®¤æäº¤å°±æ˜¯å‘å½“å‰é¡µé¢å‘é€ä¸€ä¸ªpostè¯·æ±‚">7.djangoè¡¨å•å¦‚æœä¸å†™action é‚£ä¹ˆé»˜è®¤æäº¤å°±æ˜¯å‘å½“å‰é¡µé¢å‘é€ä¸€ä¸ªpostè¯·æ±‚</h3>
<h3 id="8djangoä¸­çš„urlå‘½åèƒ½é¿å…å¯¹urlçš„ç¡¬ç¼–ç ">8.djangoä¸­çš„urlå‘½åèƒ½é¿å…å¯¹urlçš„ç¡¬ç¼–ç ï¼Œ</h3>
<ul>
<li>ä¾‹å¦‚ä¿®æ”¹ä¸€ä¸ªurl çš„è·¯å¾„å¦‚æœä»¥å‰åœ¨htmlé‡‡ç”¨çš„æ˜¯ç¡¬ç¼–ç ï¼Œç›´æ¥å†™å¯¹åº”çš„ä¼šå¯¼è‡´åé¢ä¿®æ”¹ç»´æŠ¤æä¸ºå›°éš¾ã€‚<br>
ä½†æ˜¯å¦‚æœé‡‡ç”¨urlå‘½åç©ºé—´ï¼Œé‚£ä¹ˆä¿®æ”¹çš„urlå¹¶ä¸ä¼šç›´æ¥å½±å“åˆ°ï¼Œdjangoä¼šé€šè¿‡urlçš„å‘½åè®¿é—®åˆ°ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç ã€‚<code>{% url 'url_name' other_param%}</code>  è¿™ä¸ªurl_name å°±æ˜¯åœ¨urls.pyæ–‡ä»¶ä¸­çš„<code>path('url/example', views.function,name = url_name)</code>çš„nameä¸ºurlä»çš„é‡å‘½åï¼Œè¿™æ ·ä¿®æ”¹pathå¯¹åº”çš„urlï¼Œå°±ä¸ç”¨åœ¨ç»´æŠ¤å‰ç«¯çš„é¡µé¢äº†ã€‚</li>
</ul>
<h3 id="9modelæ·»åŠ çº¦æŸ-æ•°æ®åº“çš„çº¦æŸ">9.modelæ·»åŠ çº¦æŸ (æ•°æ®åº“çš„çº¦æŸ)</h3>
<ul>
<li>ä¾‹å¦‚å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨ä¹‹é—´çš„å…³ç³»ï¼Œè®©å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨å…³è”ï¼Œé€šè¿‡<code>ForeignKry</code>æ–¹æ³•ä¸­çš„<code>to</code>å’Œ<code>to_field</code>å‚æ•°åœ¨djangoä¸­è®¾ç½®ã€‚ç”¨é€”æ˜¯å¯ä»¥æ–¹ä¾¿å¯¹è¾“å…¥æ•°æ®çš„åˆæ³•æ€§åˆ¤æ–­ï¼Œä¾‹å¦‚å‘˜å·¥ä¸èƒ½å±äºä¸€ä¸ªä¸å­˜åœ¨çš„éƒ¨é—¨ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œåˆ¤æ–­ã€‚</li>
<li>åœ¨å‘˜å·¥è¡¨ä¸­<br>
<code>department = models.ForeignKey(to = 'Department', to_field = 'id')</code><br>
è¿™å°±å°†å‘˜å·¥è¡¨å’Œéƒ¨é—¨è¡¨è¿›è¡Œäº†å…³è”ï¼Œå‘˜å·¥çš„éƒ¨é—¨åªèƒ½å±äºDepatmentä¸­çš„ä¸€ä¸ªï¼›<code>to</code>è¡¨ç¤ºå…³è”çš„è¡¨åï¼Œ<code>to_field</code>è¡¨æ˜å…³è”çš„è¡¨çš„ä¸€ä¸ªåˆ—åå­—æ®µã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œdjangoåœ¨å‚¨å­˜è¿™æ ·çš„å­—æ®µæ—¶é»˜è®¤å‘½åæ–¹å¼æ˜¯<code>å…³è”è¡¨å_id</code>ï¼ˆä¾‹å¦‚è¿™ä¸ªå°±æ˜¯<code>depaetment_id</code>ï¼‰ã€‚<br>
äºæ­¤å¯¹åº”ï¼Œåœ¨è·å–çš„æ—¶å€™ï¼Œå¦‚æœç›´æ¥é€šè¿‡å­—æ®µ/å±æ€§è·å–çš„è¯ï¼Œä¾‹å¦‚<code>obj.è”è¡¨å_id</code>ï¼Œè·å–åˆ°çš„æ—¶å‚¨å­˜åœ¨è¿™å¼ è¡¨ä¸­çš„å¯¹åº”å…³è”è¡¨çš„æ•°å­—ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å…·ä½“æŒ‡ä»£ï¼Œå› æ­¤djangoè§„å®šäº†å¦‚æœç›´æ¥<code>.è”è¡¨å</code>å°±å¯ä»¥è·å–åˆ°å…³è”è¡¨å¯¹åº”çš„é‚£ä¸€è¡Œæ•°æ®ï¼ˆå°è£…ä¸ºä¸€ä¸ªqueryobjå¯¹è±¡ï¼‰ï¼Œç„¶åå°±å¯ä»¥ç»§ç»­é€šè¿‡å…³è”è¡¨å†…çš„å±æ€§è¿›è¡ŒæŸ¥æ‰¾ã€‚ä¾‹å¦‚ï¼Œéƒ¨é—¨è¡¨ä¸­ä¸€å…±æœ‰ä¸¤ä¸ªéƒ¨é—¨ï¼Œå­—æ®µä¸ºï¼ˆid,éƒ¨é—¨åï¼‰ï¼Œå†…å®¹ä¸ºï¼ˆ1ï¼Œä¸»ç®¡éƒ¨ï¼‰ï¼ˆ2ï¼Œè¿è¡Œéƒ¨ï¼‰ï¼Œå‘˜å·¥è¡¨å…³è”</li>
<li>çº§è”åˆ é™¤ ç½®ç©ºnull<br>
ç°åœ¨è®¾æƒ³ä¸€ç§æƒ…å†µï¼Œå¦‚æœéƒ¨é—¨è¡¨ä¸­çš„ä¸€ä¸ªéƒ¨é—¨å–æ¶ˆæ‰ï¼Œé‚£ä¹ˆä¸ä¹‹å…³è”çš„å‘˜å·¥åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿå¸¸ç”¨çš„å°±æ˜¯ä¸¤ç§æ“ä½œï¼šå°†ä»–ä»¬ä¸€å¹¶åˆ é™¤ï¼ˆè¿™å°±æ˜¯çº§è”åˆ é™¤ï¼‰ï¼›è¿˜æœ‰ä¸€ç§å°±æ˜¯å°†ä»–ä»¬è®¾ç½®ä¸ºnullã€‚å¯¹åº”çš„è¿™ä¸¤ç§æ–¹å¼åœ¨djangoä¸­éœ€è¦è¿™æ ·è®¾ç½®ï¼š<br>
<code>department = models.ForeignKey(to = 'Department', to_field = 'id',on_delete=models.CASCADE)</code> çº§è”åˆ é™¤<br>
<code>department = models.ForeignKey(to = 'Department', to_field = 'id',null=True,blank=True,on_delete=models.SET_NULL)</code> ç½®ç©º  éœ€è¦æ³¨æ„çš„æ˜¯ ç½®ç©ºçš„å‰æå°±æ˜¯è¿™ä¸ªå­—æ®µå¯ä»¥ä¸ºç©º<code>null = True</code> è¿™äº›éƒ½æ˜¯djangoä¸­çš„æ“ä½œã€‚</li>
</ul>
<h3 id="10æ€§åˆ«å­˜å‚¨">10.æ€§åˆ«å­˜å‚¨</h3>
<ul>
<li>modelçš„choice ä¸æ•°æ®åº“æ— å…³ æ˜¯djangoçš„ç‰¹æ€§ å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå›ºå®šçš„é€‰æ‹©å‚¨å­˜ã€‚ä¾‹å¦‚ç”·å¥³ï¼Œå•ç‹¬ä¸ºç”·å¥³æ·»åŠ ä¸€ä¸ªcharå­—æ®µä¼šè¾ƒä¸ºæµªè´¹ç©ºé—´ï¼Œå› æ­¤ä½¿ç”¨1/2è¿™æ ·çš„æ•°å­—ä»£æ›¿ï¼Œä½†æ˜¯æ•°å­—ä¸æ˜“è¯»ï¼Œå› æ­¤djangoè®¾è®¡å‡ºäº†<code>choice</code>å‚æ•°ã€‚</li>
</ul>
<pre><code class="language-python">gender_choice = (
    (1,'ç”·'),
    (2,'å¥³'),
) #æ³¨æ„æ˜¯å…ƒç»„å¥—å…ƒç»„
gender = models.SmallIntegerField(verbose_name='æ€§åˆ«',choices = gender_choice) #verbose_nameå°±æ˜¯å¯¹åˆ—åï¼ˆå±æ€§ï¼‰çš„æ³¨è§£ å¯å†™å¯ä¸å†™ å†™ä¸Šä¸ºå¥½
#SmallIntegerFieldæ˜¯å°æ•´æ•°å­—æ®µ
</code></pre>
<ul>
<li>è¿™æ ·å­—æ®µçš„è·å–ï¼šå¦‚æœç›´æ¥<code>obj.gender</code>è·å–çš„å°±æ˜¯æ•°æ®åº“ä¸­å¯¹åº”çš„æ•°å­—ï¼Œä½†æ˜¯djangoå°è£…äº†ä¸€ä¸ªåˆ¤æ–­æ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¸®æˆ‘ä»¬åˆ¤æ–­ï¼Œç„¶åè¿”å›çš„æ˜¯æˆ‘ä»¬å¸Œæœ›ç°å®çš„å­—æ®µï¼š<code>obj.get_gender_display()</code>ã€‚å…¶ä¸­å‡½æ•°åå­—ç»„æˆæ–¹å¼ä¸º<code>get_å±æ€§åå­—/å­—æ®µåå­—_display()</code></li>
</ul>
<h3 id="11formå’Œmodelform">11.Formå’ŒModelForm</h3>
<ul>
<li>11.1 formç±» è‡ªåŠ¨ç”Ÿæˆè¡¨å•</li>
</ul>
<pre><code class="language-python">#views.py
class MyForm(Form):
    user = forms.CharField(widget=forms.Input)
    password = forms.CharField(widget=forms.Input)
    email = forms.CharField(widget=forms.Input)
def user_add(request):
    form = MyForm() #å®åŠ›åŒ–ä¸€ä¸ªformè¡¨å•ç±»
    return renderï¼ˆrequest,'user_add.html',{'form':form}
</code></pre>
<pre><code class="language-html">&lt;!-- user_add.html --&gt;
&lt;form method='post'&gt;
{% for i in form %}
{{ i }}
{% endfor %}
&lt;!-- æˆ–è€…ä¹Ÿå¯ä»¥ä¸€ä¸ªä¸€ä¸ªè‡ªå·±å†™å‡ºæ¥ æ¯”å¦‚{{form.user}} {{form.password}} --&gt;
&lt;/form&gt;
</code></pre>
<ul>
<li>11.2 ModelFormç»„ä»¶
<ul>
<li>å®ç°æ•°æ®åº“è¡¨å•å­—æ®µå’Œå‰ç«¯formè¡¨å•å­—æ®µçš„è‡ªåŠ¨ç”Ÿæˆ</li>
</ul>
<ul>
<li>å¯¹è¿æ¥è¡¨/å¤–é”®é™åˆ¶è‡ªåŠ¨ç”Ÿæˆé€‰æ‹©æ¡†</li>
<li>å®šä¹‰modelsç±»ä¸­çš„<code>__str__</code>æ–¹æ³•å®ç°å¯¹è¿æ¥è¡¨å±æ€§çš„ç›´æ¥å±•ç¤º</li>
<li>å®šä¹‰ç”Ÿæˆè¡¨å•æ ·å¼çš„å±æ€§</li>
<li><code>{{ obj.label }}</code>å¯ä»¥éå†å‡ºåœ¨modelformå®šä¹‰å­—æ®µä¸­çš„<code>label</code>å‚æ•°<br>
æ¥ä¸‹æ¥æ˜¯å…·ä½“çš„ä»£ç å±•ç¤º æœ‰ç‚¹å¤ªå¤šäº†...<br>
è®°å¾—æ·»åŠ äº†è·¯ç”±ï¼ï¼ï¼ï¼ˆè¿™ä¸ªå°±ä¸å±•ç¤ºåœ¨ä»£ç ä¸­äº†ï¼Œï¼‰</li>
</ul>
</li>
</ul>
<pre><code class="language-python">#views.py
#æ ¹æ®staffè¡¨å•ç”Ÿæˆmodelformç±»
class staffMdoelForm(ModelForm):
    class Meta:
        model = Staff
        fields = ['name','age','gender','phonenumber','create_time']

#æ·»åŠ å‘˜å·¥
def staff_add(request):
    form = staffMdoelForm() #å®ä¾‹åŒ–modelformç±» 
    return render(request,'staff_add.html',{
        'form':form
        })
</code></pre>
<pre><code class="language-html">&lt;div style=&quot;width:50%;margin-left: 25%;margin-top: 25px;&quot;&gt;
    &lt;div class=&quot;container&quot; &gt;
        &lt;form method=&quot;post&quot;&gt;
            &lt;h2&gt;æ·»åŠ æ–°çš„å‘˜å·¥ä¿¡æ¯&lt;/h2&gt;
            {% csrf_token %}
            {% for field in form %}
            &lt;div class=&quot;mb-3&quot;&gt;
                &lt;label class=&quot;form-label&quot;&gt;{{field.label}}&lt;/label&gt;
                {{ field }}
            &lt;/div&gt;
            {% endfor %}
            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;ç¡®è®¤æ·»åŠ &lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;    
&lt;/div&gt;
</code></pre>
<pre><code class="language-python">#è¿æ¥è¡¨modelformå¤„ç†ï¼ˆhtmlä¸ç”¨åšå¤ªå¤šæ”¹å˜ï¼‰
#åœ¨models.pyä¸­çš„ä»è¡¨æ·»åŠ __str__æ–¹æ³• è®©è°ƒç”¨è¿™ä¸ªç±»çš„æ—¶å€™è¿”å›çš„ä¸å†æ˜¯ä¸€ä¸ªqueryobjectè€Œæ˜¯__str__å®šä¹‰å¥½çš„è¿”å›å€¼
class Staff(models.Model):
    name = models.CharField(verbose_name='å‘˜å·¥å§“å',max_length=32)
......
    def __str__(self):
        return self.name
#åœ¨views.pyä¸­å®šä¹‰modelformç±»çš„æ—¶å€™ å­—æ®µé€‰æ‹©ç›´æ¥å†™å®šä¹‰çš„è€Œä¸æ˜¯åœ¨æ•°æ®åº“è¡¨å•ä¸­çš„å­—æ®µ
class userModelForm(ModelForm):
    class Meta:
        model = UserInfo #æ³¨ Userinfoè¡¨å•ä¸­çš„identifyæ˜¯å¼•ç”¨äº†Staffè¡¨å•ä¸­çš„idä½œä¸ºå¤–é”®
        fields = ['name','password','identify']
</code></pre>
<h3 id="12é‡å®šå‘">12.é‡å®šå‘</h3>
<ul>
<li><code>from django.shortcuts import redirect</code>æˆ–è€…<code>from django.http import HttpResponseRedirect</code><br>
returnä¸€ä¸ªé‡å®šå‘urlçš„å®ä¾‹å³å¯</li>
</ul>
<h3 id="13å‰ç«¯urlå®ç°åˆ é™¤è¯·æ±‚">13.å‰ç«¯urlå®ç°åˆ é™¤è¯·æ±‚</h3>
<ul>
<li>é€šè¿‡å‰ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰åˆ é™¤ç›®æ ‡ä¿¡æ¯çš„GETè¯·æ±‚ï¼Œç„¶ååç«¯è·å–åˆ é™¤å³å¯ï¼Œä½†æ˜¯è¿™ä¸ªå¸¦æœ‰åˆ é™¤ç›®æ ‡ä¿¡æ¯çš„urlè¯¥å¦‚ä½•ç»„è£…å‘¢ï¼Ÿé€šè¿‡urlçš„ç»„æˆè§„å¾‹ï¼Œæ·»åŠ <code>/?id=</code>ä¿¡æ¯ä¼ é€’ï¼Œä»£ç å¦‚ä¸‹ï¼š<br>
<code>&lt;a href=&quot;/login/manage/delete/?id={{user.0}}&quot;&gt;åˆ é™¤&lt;/a&gt;</code>  #è¿™å…¶ä¸­çš„{{id.0}}é€šè¿‡djangoçš„æ¨¡æ¿è¯­æ³•åŠ¨æ€èµ‹äºˆç›®æ ‡çš„idä¿¡æ¯<br>
å¯¹åº”å¤„ç†å‡½æ•°ï¼ˆè®°å¾—æ³¨å†Œurlï¼‰</li>
</ul>
<pre><code class="language-python">def delete_user_info(request):
    id = request.GET.get('id')
    UserInfo.objects.filter(id = id).delete()
    return HttpResponseRedirect('/login/manage/')
</code></pre>
<h3 id="14djangoçš„æ¨¡æ¿è¯­æ³•">14.djangoçš„æ¨¡æ¿è¯­æ³•</h3>
<ul>
<li>å…¶ä¸­æœ€å¼€å§‹çš„<code>{% extends 'nav.html'%}</code>å¿…é¡»å¤„äºå­é¡µé¢çš„ç¬¬ä¸€ä¸ªåŠ è½½ä½ç½®ï¼Œæ„å‘³ç€å¦‚æœå‰é¢æœ‰å“ªæ€•<code>{% load static %}</code>ä¹Ÿä¼šæŠ¥é”™ã€‚</li>
</ul>
<h3 id="15djangoæ­£åˆ™åŒ¹é…url">15.djangoæ­£åˆ™åŒ¹é…url</h3>
<ul>
<li>è¿™æ ·å°±ä¸ç”¨å‰ç«¯å†™å¸¦æœ‰getå‚æ•°çš„urlï¼Œåç«¯ä¹Ÿä¸éœ€è¦getè·å–,è€Œæ˜¯ç›´æ¥ä½œä¸ºä¸€ä¸ªè§£æå¥½çš„å‚æ•°ä¼ é€’ç»™è§†å›¾è¿›è¡Œå¤„ç†ï¼ŒäºŒæ˜¯ç›´æ¥åŠè¿›è¡Œè¯·æ±‚å’Œè§£æã€‚åŒæ—¶ä¹Ÿè¦æ³¨æ„ï¼Œåœ¨urlä¸­æ·»åŠ çš„æ­£åˆ™é¡ºåºä¸å½±å“åœ¨å‘½åurlä¸­çš„å‚æ•°é¡ºåº</li>
</ul>
<ul>
<li>å…·ä½“å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="language-python">#htmlä¸­
&lt;a href=&quot;{% url 'edit' user.0 %}&quot;&gt;æ“ä½œ...&lt;/a&gt;
#urlä¸­
path('login/manage/&lt;int:id&gt;/edit/',views.edit_user_info,name = 'edit')
#viewsä¸­
def edit_user_info(request,id):
    default_userinfo = UserInfo.objects.filter(id = id).first()
    ....
</code></pre>
<p>å¯ä»¥çœ‹åˆ°<code>&lt;int:id&gt;</code>æ˜¯åœ¨<code>/edit/</code>ä¹‹å‰çš„ï¼Œä½†æ˜¯åœ¨htmlçš„urlä¸­è¿™ä¸ªé¡ºåºä¸å½±å“ã€‚åŒæ—¶åœ¨viewsä¸­å¯¹åº”çš„å‡½æ•°å¯ä»¥ç›´æ¥æ¥æ”¶åˆ°urlä¸­æ­£åˆ™åŒ¹é…åˆ°çš„å‚æ•°ï¼Œè€Œä¸ç”¨å†é€šè¿‡è§£ægetè¯·æ±‚è·å–ã€‚</p>
<h3 id="16åœ¨djangoçš„æ¨¡æ¿ä¸­å¯ä»¥é€šè¿‡objget_è”è¡¨å_displayè·å–åˆ°å’Œåç«¯get_è”è¡¨å_displayçš„æ•ˆæœç›´æ¥è¿”å›å¯¹ç…§è¿‡åçš„ç»“æœè€Œä¸æ˜¯å¯¹åº”çš„å…³è”id">16.åœ¨djangoçš„æ¨¡æ¿ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>obj.get_è”è¡¨å_display</code>è·å–åˆ°å’Œåç«¯<code>get_è”è¡¨å_display()</code>çš„æ•ˆæœï¼Œç›´æ¥è¿”å›å¯¹ç…§è¿‡åçš„ç»“æœè€Œä¸æ˜¯å¯¹åº”çš„å…³è”idã€‚</h3>
<h3 id="17djangoçš„æ¨¡æ¿å¯ä»¥è¿›è¡Œçš„é¢å¤–æ“ä½œ">17.djangoçš„æ¨¡æ¿å¯ä»¥è¿›è¡Œçš„é¢å¤–æ“ä½œï¼š</h3>
<ul>
<li><code>{{number : add 1}}</code>å°±æ˜¯pythonçš„<code>+=1</code>æ“ä½œï¼Œ<code>{{datetime | date :'Y-m-d}}</code>å°±æ˜¯pythonä¸­çš„<code>strftime()</code>å‡½æ•°(è¦æ³¨æ„çš„æ˜¯é‡Œé¢çš„æ ¼å¼ä¸éœ€è¦å¸¦<code>%</code>)</li>
</ul>
<h3 id="18modelformçš„å­—æ®µæ ¡éªŒå‡½æ•°">18.modelformçš„å­—æ®µæ ¡éªŒå‡½æ•°</h3>
<ul>
<li><code>is_valid()</code>æ£€éªŒæäº¤postè¯·æ±‚ä¸­çš„formè¡¨å•ä¸­çš„å­—æ®µæ˜¯å¦ä¸ºç©ºï¼Œå…·ä½“çš„å­—æ®µå°±æ˜¯åœ¨<code>modelform</code>ä¸­<code>fields</code>åˆ—è¡¨å®šä¹‰çš„é‚£äº›.</li>
<li>åŒæ—¶è¿˜å¯ä»¥åœ¨modelformsç±»ä¸­è¿›è¡Œå­—æ®µæ ¡éªŒ é”™è¯¯çš„ä¿¡æ¯ä¼šä¿å­˜åœ¨ç”¨postè¯·æ±‚å®ä¾‹åŒ–çš„modelformä¸­ã€‚</li>
</ul>
<pre><code class="language-python">class staffMdoelForm(ModelForm):
    phonenumber = forms.CharField(label='ç”µè¯å·ç ',max_length=11,min_length=11)#è¿›è¡Œçš„å­—æ®µæ ¡éªŒ 
    #è§„å®šç”µè¯å·ç çš„é•¿åº¦ä¸º11ä½
    #è¿˜å¯ä»¥é€šè¿‡validatorså‚æ•°è¿›è¡Œæ­£åˆ™ç­›é€‰
    class Meta:
        model = Staff
        fields = ['name','age','gender','phonenumber','create_time']
    phonenumber = forms.CharField(label='ç”µè¯å·ç ',max_length=11,min_length=11)
    #è§„å®šç”µè¯å·ç çš„é•¿åº¦ä¸º11ä½
    #è¿˜å¯ä»¥é€šè¿‡validatorså‚æ•°è¿›è¡Œæ­£åˆ™ç­›é€‰
</code></pre>
<h3 id="19è°ƒæ•´è¿”å›çš„æç¤ºä¿¡æ¯ä¸ºæ±‰è¯­">19.è°ƒæ•´è¿”å›çš„æç¤ºä¿¡æ¯ä¸ºæ±‰è¯­</h3>
<ul>
<li>é€šè¿‡ä¿®æ”¹setting.pyæ–‡ä»¶ä¸­çš„è¯­è¨€é¡¹</li>
</ul>
<pre><code class="language-python">#setting.py
# LANGUAGE_CODE = &quot;en-us&quot; æ³¨é‡Šæ‰
LANGUAGE_CODE = &quot;zh-hans&quot; #æ·»åŠ 
</code></pre>
<h3 id="20modelformä¸­instanceå‚æ•°">20.modelformä¸­<code>instance</code>å‚æ•°</h3>
<ul>
<li>é€šè¿‡è®¾ç½®å•æ¡æ•°æ®å¯¹è¡¨å•è¿›è¡Œå¡«å……ï¼Œä¾‹å¦‚ï¼š</li>
</ul>
<pre><code class="language-python">#views.pyä¸­çš„ä¸€ä¸ªæ–¹æ³•
default_userinfo = UserInfo.objects.filter(id = id).first() #æ ¹æ®idåœ¨æ•°æ®åº“ä¸­è·å–å¯¹åº”çš„ä¸€æ¡æ•°æ®
userform = userModelForm(instance=default_userinfo) # é€šè¿‡instanceå‚æ•°è®¾å®šä¸€ä¸ªå®ä¾‹åŒ–çš„è¡¨å• è®©ä»–åœ¨å‰ç«¯æ¸²æŸ“çš„æ—¶å€™è‡ªåŠ¨åœ¨valueä¸Šæ˜¾ç¤ºä»æ•°æ®åº“ä¸­æ‹¿åˆ°çš„é»˜è®¤å€¼
</code></pre>
<ul>
<li>é€šè¿‡<code>instance</code>å‚æ•°å’Œ<code>data</code>å‚æ•°å¯ä»¥å®ç°æ•°æ®åº“æ•°æ®çš„æ›´æ–°</li>
</ul>
<pre><code class="language-python">#åœ¨views.pyä¸­çš„æŸä¸ªå‡½æ•°
default_userinfo = UserInfo.objects.filter(id = id).first()
userform = userModelForm(data=request.POST,instance=default_userinfo)
if userform.is_valid():
    userform.save()
    return redirect('/login/manage/')
else:
    return render(request,'edit_info.html',{
        'userform': userform,
    })
</code></pre>
<ul>
<li>å¦‚æœæƒ³åœ¨ç”¨æˆ·è¾“å…¥ä»¥å¤–çš„å­—æ®µè¿›è¡Œæ›´æ–°ï¼Œé‚£ä¹ˆåœ¨modelformå®ä¾‹åŒ–ä¹‹åé€šè¿‡<code>instacne</code>å±æ€§å¯ä»¥ä¿®æ”¹ï¼š</li>
</ul>
<pre><code class="language-python">userform = userModelForm(data=request.POST,instance=default_userinfo)
# useform.instance.å­—æ®µ =  å€¼
</code></pre>
<h3 id="21djangoæŸ¥è¯¢æ’åº">21.djangoæŸ¥è¯¢æ’åº</h3>
<ul>
<li><code>obj.objects.all().order_by('å±æ€§å')</code><br>
å¦‚æœç»™å±æ€§åå‰é¢æ·»åŠ å‡å· ä»£è¡¨é€†å‘ï¼ˆé«˜åˆ°ä½ï¼‰æ’åº</li>
</ul>
<h3 id="22ç»™åŸæœ‰çš„è¡¨ä¸­æ·»åŠ æ–°çš„å­—æ®µäº§ç”Ÿé”™è¯¯djangocoreexceptionsvalidationerror-error">22.ç»™åŸæœ‰çš„è¡¨ä¸­æ·»åŠ æ–°çš„å­—æ®µäº§ç”Ÿé”™è¯¯<code>&quot;django.core.exceptions.ValidationError&quot; error</code></h3>
<ul>
<li>äº§ç”ŸåŸå› ï¼šå¤§æ¦‚ç‡æ˜¯å› ä¸ºè¿½åŠ æ–°çš„å­—æ®µè®¾ç½®é»˜è®¤å€¼çš„æ—¶å€™äº§ç”Ÿçš„æ ¼å¼é”™è¯¯ï¼Œä¾‹å¦‚datetimeæ ¼å¼ä½†æ˜¯æ²¡æœ‰è®¾ç½®é»˜è®¤æˆ–è€…é»˜è®¤æ ¼å¼é”™è¯¯ï¼Œé€ æˆè¿™æ ·çš„åŸå› ã€‚</li>
<li>è§£å†³æ–¹æ³•ï¼šé‡ç½®æ‰€æœ‰çš„<code>migrations</code></li>
<li>æ“ä½œï¼šåˆ é™¤migrationsæ–‡ä»¶å¤¹ä¸‹é™¤äº†<code>__init__.py</code>æ–‡ä»¶ä»¥å¤–æ‰€æœ‰çš„æ–‡ä»¶ï¼Œç„¶åé‡æ–°æ‰§è¡Œæ•°æ®åº“è¿ç§»å‘½ä»¤ï¼š<code>python manage.py makemigrations</code>, <code>python manage.py migrate</code></li>
<li>å¦‚æœè¿˜ä¸æˆåŠŸå¯èƒ½æ˜¯å› ä¸ºæ•°æ®åº“ä¸­åŸæœ¬å­˜åœ¨çš„æ•°æ®å¯¼è‡´ï¼Œå°†æ•°æ®åº“æ¸…åº“ï¼ˆæ‰€æœ‰è¡¨åˆ é™¤ï¼‰ï¼Œç„¶ååœ¨æ‰§è¡Œå³å¯ã€‚</li>
</ul>
<h3 id="23djangoæŠ¥é”™orderform-object-has-no-attribute-get">23.djangoæŠ¥é”™<code>'orderForm' object has no attribute 'get'</code></h3>
<ul>
<li>åŸå› æ˜¯åœ¨è®¾ç½®<code>input</code>æ ‡ç­¾çš„æ ·å¼çš„æ—¶å€™é‡å†™çš„çˆ¶ç±»æ–¹æ³•å‡ºé”™ï¼Œå‚æ•°å¤šå†™äº†ä¸€ä¸ª<code>self</code></li>
</ul>
<pre><code class="language-python">#é”™è¯¯æºç 
    def __init__(self,*arg,**kwargs):
        super().__init__(self,*arg,**kwargs)
        for name, field in self.fields.items():
            # print(name,field) #è¿™ä¸ªæ˜¯å±•ç¤º self.fields.items()å¯ä»¥ç›´æ¥æ‹¿åˆ°å®šä¹‰åœ¨Metaä¸­çš„fieldså­—æ®µ
            field.widget.attrs = {'class' : 'form-control'} #ä¸ºç”Ÿæˆçš„è¡¨å•inputèµ‹äºˆcsså±æ€§ 
</code></pre>
<ul>
<li>è§£å†³æ–¹æ³• ï¼š å»æ‰<code>super().__init__(self,*arg,**kwargs)</code>è¿™ä¸€è¡Œä¸­çš„selfå³å¯ï¼Œæ­£ç¡®å†™æ³•ï¼š<br>
<code>  super().__init__(*arg,**kwargs)</code></li>
<li>æ¢ç©¶ä¸€ä¸‹ä¸ºä»€ä¹ˆ<code>super</code>ä¸éœ€è¦<code>self</code>ä½œä¸ºæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š<br>
å› ä¸º<code>super()</code>æ˜¯ä¸€ä¸ªç±» <a href="https://mozillazg.com/2016/12/python-super-is-not-as-simple-as-you-thought.html#hidsuper">reference</a> -- æ„Ÿè§‰å¥½å¤š...æš‚æ—¶æç½®ä¸€ä¸‹...ğŸ˜–</li>
</ul>
<h3 id="24å…³é—­æµè§ˆå™¨æ ¡éªŒ">24.å…³é—­æµè§ˆå™¨æ ¡éªŒ</h3>
<p>åœ¨formè¡¨å•æ·»åŠ <code>novalidate</code></p>
<pre><code class="language-html">&lt;form method=&quot;post&quot; novalidate &gt;
</code></pre>
<h3 id="25å…³äºmodelsä¸­nullå’Œblackå­—æ®µ">25.å…³äºmodelsä¸­nullå’Œblackå­—æ®µ</h3>
<ul>
<li>éœ€è¦åŒæ—¶å¼€å¯ï¼Œä½†æ˜¯æ•°æ®åº“æ›´æ¨èé»˜è®¤å€¼ä¸ºç©ºå€¼ï¼Œå› æ­¤è®¾ç½®<code>default=None</code>è€Œä¸æ˜¯<code>null</code>ã€‚<br>
å¦‚æœè®¾ç½®<code>blank=True</code>ä½†æ˜¯ä¸å¼€å¯<code>null=True</code>ï¼Œé‚£ä¹ˆåœ¨æ’å…¥çš„æ—¶å€™ï¼Œå¦‚æœä¼ å›æ¥çš„æ•°æ®ä¸ºç©ºï¼Œæ’å…¥ä¼šæŠ¥é”™ä¸èƒ½ä¸ºnullå­—æ®µ...æ€»ä¹‹è¿˜æ˜¯å¾ˆè¿·æƒ‘çš„æŠ¥é”™....ä½†æ˜¯è§£å†³æ–¹æ³•è¿˜æ˜¯æœ€å¥½è®¾ç½®ä¸¤ä¸ªéƒ½ä¸ºTrueå¹¶ä¸”è®¾ç½®é»˜è®¤å­—æ®µä¸º<code>None</code>ã€‚å¦‚æœä¸º<code>null</code>ï¼Œé‚£ä¹ˆåœ¨æ•°æ®ä¼ å…¥åˆ°å‰ç«¯çš„æ—¶å€™ä¼šé»˜è®¤è¾“å‡ºnullæˆ–è€…noneï¼Œè€Œä¸æ˜¯å°†é‚£ç‰‡åŒºåŸŸç½®ç©ºï¼Œå¯¹äºå‰ç«¯çš„ç”¨æˆ·è¾“å…¥é€»è¾‘ä¸å¤ªå‹å¥½ã€‚</li>
</ul>
<h3 id="26modelformsä¾¿æ·å†™æ³•">26.modelformsä¾¿æ·å†™æ³•</h3>
<ul>
<li>åœ¨æ·»åŠ fieldsçš„æ—¶å€™ï¼Œå¯ä»¥ç”¨<code>__all__</code>ä¸€æ¬¡æ€§è·å–å…¨éƒ¨ï¼Œ<code>exclude = [ æ’é™¤çš„å­—æ®µ ]</code>æ’é™¤æ‰ä¸è¦çš„å­—æ®µã€‚</li>
</ul>
<pre><code class="language-python">class orderForm(ModelForm):
    class Meta():
        model = Orderform
        fields = &quot;__all__&quot; #æ³¨æ„è¦å¼•å·
        # exclude = ['å­—æ®µ1','å­—æ®µäºŒ', .... ]
</code></pre>
<h3 id="27åç«¯è¡¨å•æ­£åˆ™æ ¡éªŒ">27.åç«¯è¡¨å•æ­£åˆ™æ ¡éªŒ</h3>
<ul>
<li>åœ¨modelformsç±»ä¸­å£°æ˜å­—æ®µï¼Œç„¶åé€šè¿‡validatorså‚æ•°è®¾ç½®æ­£åˆ™è¡¨è¾¾å¼ï¼š</li>
</ul>
<pre><code class="language-python">from django.core.validators import RegexValidator #éœ€è¦å¯¼å…¥æ­£åˆ™ç±»
class exampleModelForms(forms.ModelForm):
    moblie = forms.CharField(
        label = 'æ‰‹æœºå·ç ',
        validactors = [RegexValidator(r'^1[3-9]\d{9}$','æ‰‹æœºå·æ ¼å¼é”™è¯¯')]       
        #æ ¡éªŒå¤±è´¥è¿”å›åé¢çš„æç¤ºä¿¡æ¯è€Œä¸æ˜¯é»˜è®¤çš„äº†~ 
    )
</code></pre>
<h3 id="28é’©å­æ–¹æ³•è¿›è¡Œå­—æ®µæ ¡éªŒ">28.é’©å­æ–¹æ³•è¿›è¡Œå­—æ®µæ ¡éªŒ</h3>
<ul>
<li><a href="https://www.cnblogs.com/open-yang/p/11223175.html">è¯¦ç»†çš„</a></li>
<li>è¿™é‡Œæ‘˜åˆ—å‡ºå¸¸ç”¨çš„ä»£ç ç»“æœ</li>
</ul>
<pre><code class="language-python">class exampleModelForms(forms.ModelForm):
   def clean_å­—æ®µå(self): #è¿™ä¸ªéœ€è¦åœ¨ä¸€ä¸ªmodelformç±»ä¸­ è¿™ä¸ªå‡½æ•°åmodelformä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æ–¹æ³•
           pass 
           name = self.cleaned_data.get('name')
           if name=='admin':
               raise ValidationError('adminæ˜¯è¶…çº§ç®¡ç†å‘˜ï¼Œä¸èƒ½æ³¨å†Œï¼')#è¿™ä¸ªé”™è¯¯ä¼šç›´æ¥æ‰”è¿›è¯¥å­—æ®µçš„é”™è¯¯ç±»åˆ«ä¸­ï¼šname.errors
           return self.cleaned_data.get('name')
</code></pre>
<h3 id="29è§„å®šmodelformä¸­ä¸å¯ç¼–è¾‘çš„éƒ¨åˆ†">29.è§„å®šmodelformä¸­ä¸å¯ç¼–è¾‘çš„éƒ¨åˆ†</h3>
<p>åœ¨modelformä¸­å­—æ®µä¸­è®¾ç½®å‚æ•°<code>disabled= True</code>å³å¯ï¼Œè¿™æ ·åœ¨å‰ç«¯é¡µé¢æ¸²æŸ“å‡ºæ¥çš„è¿™ä¸€æ¡å­—æ®µæ˜¯ä¸å¯ä»¥æ›´æ”¹çš„ã€‚</p>
<h3 id="30é€šè¿‡modelformåˆ¤æ–­è¦æ·»åŠ çš„æ•°æ®æ˜¯å¦é‡å¤">30.é€šè¿‡modelformåˆ¤æ–­è¦æ·»åŠ çš„æ•°æ®æ˜¯å¦é‡å¤</h3>
<ul>
<li><code>order_edit_form = orderEditForm().filter(id=ä½ è¦æŸ¥è¯¢çš„).exist()</code> è¿”å›True/False<br>
è¿™ä¸ªæ–¹æ³•éœ€è¦æ·»åŠ åœ¨modelformä¸­çš„é’©å­æ–¹æ³•ä¸­ã€‚</li>
<li>æ’é™¤è‡ªå·±ä»¥å¤–çš„æ˜¯å¦å­˜åœ¨é‡å¤ï¼Ÿ(ä¸»è¦æ˜¯åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼‰<br>
é€šè¿‡<code>exclude</code>æ’é™¤è‡ªå·±ååˆ¤æ–­ï¼š<code>order_edit_form = orderEditForm().exclude(id='è‡ªå·±çš„id' ).filter(id=ä½ è¦æŸ¥è¯¢çš„).exist()</code> è¿”å›True/False</li>
</ul>
<p>æ€»ç»“ ç¼–è¾‘å’Œæ·»åŠ çš„ä¸åŒ</p>
<h3 id="31æŸ¥è¯¢æ ¹æ®æŸä¸ªå­—çš„ä¸€éƒ¨åˆ†è¿›è¡Œ">31.æŸ¥è¯¢ï¼ˆæ ¹æ®æŸä¸ªå­—çš„ä¸€éƒ¨åˆ†è¿›è¡Œï¼‰</h3>
<ul>
<li><code>filter()</code>è¿˜æ”¯æŒä¼ å…¥å­—å…¸ï¼š</li>
</ul>
<pre><code class="language-python">order_edit_form = orderEditForm().filter(id=ä½ è¦æŸ¥è¯¢çš„,other=ä½ è¦æŸ¥è¯¢çš„)
#ç­‰äº
query_dict = { 'id' : è¦æŸ¥è¯¢çš„, 'other' : è¦æŸ¥è¯¢çš„ }
order_edit_form = orderEditForm().filter(**query_dict)
 #éœ€è¦æ³¨æ„ä¼ å…¥å­—å…¸çš„æ—¶å€™éœ€è¦ä¸¤ä¸ª**
</code></pre>
<p>PS. é€šå¸¸æˆ‘ä»¬å†å˜é‡å‰åŠ ä¸€ä¸ªæ˜Ÿå·(*)è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯å…ƒç»„/åˆ—è¡¨ï¼ŒåŠ ä¸¤ä¸ªæ˜Ÿå·è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å­—å…¸</p>
<h3 id="32é—®é¢˜è®°å½•modelformä¸èƒ½æ›´æ–°ä¸€è¡Œæ•°æ®çš„éƒ¨åˆ†å­—æ®µ">32.é—®é¢˜è®°å½•ï¼šmodelformä¸èƒ½æ›´æ–°ä¸€è¡Œæ•°æ®çš„éƒ¨åˆ†å­—æ®µ</h3>
<ul>
<li><a href="https://www.qiniu.com/qfans/qnso-8216353#comments">è§£å†³æ–¹æ³•</a><br>
è¿™é‡Œçš„è§£å†³æ–¹æ³•å¾ˆå¤š åŒ…æ‹¬è‡ªå®šä¹‰é’©å­å‡½æ•°å¯¹postæ•°æ®è¿›è¡Œæ¸…æ™°ã€å®šä¹‰ä¸€ä¸ªå·¥å‚å‡½æ•°å¤„ç†æ¯æ¬¡ä¸åŒçš„å­—æ®µç­‰ï¼Œä¸è¿‡éƒ½å¤ªé«˜ç«¯äº†ï¼Œéƒ¨åˆ†æ¦‚å¿µæˆ‘è¿˜æ²¡æœ‰ç†è§£æ¸…æ¥šğŸ˜­</li>
<li>å› æ­¤æˆ‘æ‰“ç®—é‡‡å–æœ€ç®€å•çš„ -- ä¸€ä¸ªå­—æ®µä¸€ä¸ªå­—æ®µçš„å»<code>update</code>ğŸ˜³ã€‚ æˆ–è€…é‡‡ç”¨dictçš„æ¨¡å¼ï¼Œå¤„ç†ä¸å˜çš„å­—æ®µå’Œæ›´æ–°åçš„å­—æ®µ ç»„åˆæˆä¸ºä¸€ä¸ªæ›´æ–°åçš„å­—å…¸ç„¶åé€šè¿‡modelformä¿å­˜..</li>
<li>æœ€åå‘ç°æ˜¯æˆ‘å®ä¾‹åŒ–å‡ºé”™äº†çš„é—®é¢˜....(çœŸè¯šçš„çœ¼çğŸ˜­)</li>
</ul>
<pre><code class="language-python">    row_object = Orderform.objects.filter(id = id).first() #æ³¨æ„è¿™é‡Œå®ä¾‹åŒ–çš„æ˜¯ä¸€ä¸ªformç±» ä¹‹å‰é”™è¯¯çš„åŸå› æ˜¯è¿™é‡Œä¹Ÿå†™æˆäº†ä¸€ä¸ªmodelformç±» è¿™å°±å¯¼è‡´ä¸‹é¢instanceçš„æ—¶å€™ä¼šæŠ¥é”™ è€Œä¸”é»˜è®¤ä¸æ›´æ–°çš„å‰ç«¯æ•°æ®å®é™…ä¸Šæ˜¯ä¼šä¼ é€’å›æ¥çš„ ä½œä¸ºè¡¨å•çš„é»˜è®¤å€¼
    order_edit_form = orderEditForm(data=request.POST,instance=row_object) 
    #è¿™é‡Œå®ä¾‹åŒ–çš„æ˜¯ä¸€ä¸ªmodelformsç±»
</code></pre>
<h3 id="33djangoçš„æ¡ä»¶æŸ¥è¯¢">33.djangoçš„æ¡ä»¶æŸ¥è¯¢</h3>
<p>é™¤äº†å›ºå®šçš„ç­‰äºï¼ˆ<code>=</code>ï¼‰æŸ¥è¯¢å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ç»™å­—æ®µ/å±æ€§æ·»åŠ ä¸‹åˆ’çº¿çš„æ–¹å¼è§„å®šèŒƒå›´æŸ¥è¯¢</p>
<ul>
<li>æ•°å­—æ–¹é¢ï¼šgtã€gteã€ltã€lteï¼šå¤§äºã€å¤§äºç­‰äºã€å°äºã€å°äºç­‰äºã€‚<br>
<code>list = BookInfo.objects.filter(id__gt=3) </code> ä»£è¡¨idå¤§äº3çš„æ•°æ®<br>
PS. ä¸ç­‰äºå¯ä»¥é€šè¿‡<code>exclude</code>è¿‡æ»¤</li>
<li>å­—ç¬¦ä¸²æ–¹é¢ï¼šstartswithã€endswithï¼šä»¥æŒ‡å®šå€¼å¼€å¤´æˆ–ç»“å°¾ï¼›containsï¼šæ˜¯å¦åŒ…å«ã€‚<br>
<code>list = BookInfo.objects.filter(btitle__endswith='éƒ¨')</code> æŸ¥è¯¢æ˜¯å¦æ•°æ®ä¸­btitleå­—æ®µä»¥â€˜éƒ¨â€™è¿™ä¸ªå­—ç»“å°¾çš„ä¸€è¡Œæ•°æ®ã€‚</li>
<li>æ—¥æœŸæŸ¥è¯¢ï¼š yearã€monthã€dayã€week_dayã€hourã€minuteã€secondï¼šå¯¹æ—¥æœŸæ—¶é—´ç±»å‹çš„å±æ€§è¿›è¡Œè¿ç®—ã€‚<br>
<code>list = BookInfo.objects.filter(bpub_date__year=1980)</code> æŸ¥è¯¢1980å¹´å‘è¡¨çš„å›¾ä¹¦<br>
<code>list = BookInfo.objects.filter(bpub_date__gt=date(1990,1,1))</code>  æŸ¥è¯¢1980å¹´1æœˆ1æ—¥åå‘è¡¨çš„å›¾ä¹¦ã€‚</li>
<li>è¿˜æœ‰å¾ˆå¤šæŸ¥è¯¢ï¼š ä¾‹å¦‚æ¯”è¾ƒåŒä¸€è¡Œæ•°æ®ä¸¤ä¸ªå­—æ®µä¹‹é—´çš„å…³ç³»ï¼ˆå¦‚é˜…è¯»æ•°é‡&gt;=è¯„è®ºæ•°é‡ï¼‰ã€ä¸æˆ–éæŸ¥è¯¢ã€èšåˆç­‰... å…·ä½“å‚è€ƒ<a href="https://www.jianshu.com/p/bde1ece240bc">reference</a>æˆ–è€…å®˜ç½‘</li>
</ul>
<p>PS. 1. <code>filter</code>å¯ä»¥è¿ç»­ä½¿ç”¨ ï¼š<code>list=BookInfo.objects.filter(bread__gt=20).filter(id__lt=3)</code> 2. <code>filter</code>å¯ä»¥ä¼ å…¥å­—å…¸</p>
<h3 id="34è®¾ç½®geté»˜è®¤å€¼">34.è®¾ç½®geté»˜è®¤å€¼</h3>
<ul>
<li><code>request.GET.get('page', '1')</code> è·å–getè¯·æ±‚ï¼Œå¦‚æœgetæ²¡æœ‰é™„å¸¦pageå‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤æ˜¯1.</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Extra details of python - for long term - part.2]]></title>
        <id>https://cyanineeee.github.io/post/extra-details-of-python-for-long-term-part2/</id>
        <link href="https://cyanineeee.github.io/post/extra-details-of-python-for-long-term-part2/">
        </link>
        <updated>2023-06-26T04:11:23.000Z</updated>
        <content type="html"><![CDATA[<h1 id="2023-06-26">2023-06-26</h1>
<h3 id="9-pythonä¸­çš„__init__py">9. pythonä¸­çš„__init__.py</h3>
<p><a href="https://zhuanlan.zhihu.com/p/115350758">reference</a><br>
åœ¨pythonå·¥ç¨‹ä¸­ï¼Œå½“pythonåœ¨ä¸€ä¸ªç›®å½•ä¸‹æ£€æµ‹åˆ°<code>__init__.py</code>æ–‡ä»¶æ—¶ï¼Œå°±ä¼šæŠŠå®ƒå½“æˆä¸€ä¸ªmoduleã€‚<code>__init__.py</code>å¯ä»¥æ˜¯ç©ºçš„ï¼Œä¹Ÿå¯ä»¥æœ‰å†…å®¹ã€‚</p>
<p>--æœªæ•´ç†å®Œ</p>
<h3 id="10-pythonä¸­çš„getattræ–¹æ³•">10. pythonä¸­çš„getattr()æ–¹æ³•</h3>
<p><code>getattr</code>æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ªæ¨¡å—å…¶ä¸­çš„æ–¹æ³•å’Œå±æ€§ï¼ŒåŒ…æ‹¬classåã€ç›´æ¥å®šä¹‰çš„æ–¹æ³•ä»¥åŠå±æ€§ã€‚<br>
ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-python">#åœ¨example.pyæ–‡ä»¶ä¸­
class magical_method():
    def __init__(self,num1,num2,num3):
        self.num1 = num1
        self.num2 = num2
        self.num3 = num3
    def __contains__(self,tar):
        if tar == self.num1 or tar == self.num2 or tar == self.num3:
            return False
        else:
            return True
    def name(self):
        print('qwe')

def another_example():
    print('asdasd')

ppp = 2
</code></pre>
<pre><code class="language-python">#åœ¨åŒç›®å½•ä¸‹çš„test.pyæ–‡ä»¶ä¸­
import example
attr = dir(example)
print(attr)
</code></pre>
<pre><code class="language-python">#è¾“å‡º
['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'another_example', 'magical_method', 'ppp']
</code></pre>
<p>éœ€è¦æ³¨æ„çš„å‡ ä¸ªç‚¹ï¼šä¸€åªä¼šè¾“å‡ºç›´æ¥å®šä¹‰åœ¨æ¨¡å—ä¸­çš„ç±»åã€æ–¹æ³•ã€å±æ€§ï¼ˆå˜é‡ï¼‰ï¼Œå¦‚æœå±æ€§/æ–¹æ³•/ç±»æ˜¯åœ¨å…¶ä»–ç±»/æ–¹æ³•ä¹‹ä¸‹ï¼Œé‚£ä¹ˆä¸ä¼šéå†å‡ºæ¥ï¼›äºŒå¯ä»¥é€šè¿‡<code>isinstance(attr, type)</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦æ˜¯ç±»ã€<code>callable(func_name)</code>åˆ¤æ–­æ˜¯å¦æ˜¯å‡½æ•°ï¼ˆæ˜¯å¦å¯ä»¥è¢«è°ƒç”¨ï¼‰ã€<code>hasattr(obj, attr)</code>ç”¨æ¥åˆ¤æ–­å±æ€§æ˜¯å¦åœ¨æŒ‡å®šç±»ä¸­ï¼›ä¸‰å¦‚æœæ²¡æœ‰<code>__name__ == &quot;__main__&quot;</code>ï¼Œé‚£ä¹ˆåœ¨dirçš„æ—¶å€™ä¼šæ‰§è¡Œè¯¥æ¨¡å—ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[pythonç½‘ç»œç¼–ç¨‹ -- å»ºç«‹ä¸€ä¸ªhttpæœåŠ¡å™¨+twistedæ¨¡å—--part.2]]></title>
        <id>https://cyanineeee.github.io/post/part2/</id>
        <link href="https://cyanineeee.github.io/post/part2/">
        </link>
        <updated>2023-06-26T03:45:40.000Z</updated>
        <content type="html"><![CDATA[<h1 id="">=&gt;</h1>
<p>HTTPåŸºç¡€å“åº”</p>
<ol>
<li>httpæœåŠ¡å™¨</li>
</ol>
<pre><code class="language-python"># 1.é¦–å…ˆéœ€è¦socketè¿›è¡Œåè®®ã€ç«¯å£è®¾ç½®
# 2. ç„¶åå› ä¸ºæ€§èƒ½åŸå›  éœ€è¦è®¾ç½®å¤šè¿›ç¨‹å“åº”å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚
# 3. è®¾ç½®å¤„ç†å®¢æˆ·ç«¯å‘é€ä¿¡æ¯
# 4. è¿”å›å“åº”çš„htmlä»¥åŠhttpå¤´ä¿¡æ¯
import socket
import multiprocessing
class HttpServer:
    def __init__(self,port):  #è¿›è¡Œsocketåˆå§‹è®¾ç½® ç»‘å®šç«¯å£å¼€å¯ç›‘å¬
        self.port = port
        self.server_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM) #å®ä¾‹socketå¯¹è±¡
        self.server_socket.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1) #è¿›è¡Œsocketé€‰é¡¹è®¾ç½®
        self.server_socket.bind(('0.0.0.0',port)) #ç»‘å®šç›‘å¬ç«¯å£
        self.server_socket.listen() #å¼€å¯ç›‘å¬ åœ¨æ„é€ å‡½æ•°å†…å¼€å¯ç›‘å¬ä»£è¡¨æ¯ä¸€ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªhttpæœåŠ¡å™¨ç¨‹åº

    def start(self): #æ¥æ”¶æœåŠ¡ç«¯ä¿¡æ¯ è¿›è¡Œå¤„ç†
        while True:
            client_scoket, client_addr = self.server_socket.accept()
            print(f'ã€æ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‘å®¢æˆ·ç«¯ip{client_addr[0]},è®¿é—®ç«¯å£{client_addr[1]}')
            handle_socket = multiprocessing.Process(target=self.handle_response,args=(client_scoket,))#å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯è¯·æ±‚
            handle_socket.start()

    def handle_response(self,client_socket): #å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯
        request_headers = client_socket.recv(1024)
        print(f'ã€å®¢æˆ·ç«¯æ¸…è¯·æ±‚å¤´ä¿¡æ¯ã€‘{request_headers}') #å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¿¡æ¯

        #å¼€å§‹å¤„ç†å“åº”ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯
        response_start_line = 'HTTP/1.1 200 OK\r\n' #æœ¬æ¬¡ç›¸åº”æˆåŠŸ
        #æ‰‹åŠ¨å†™httpå“åº”å¤´ ä¹‹åä¼šå‘é€ç»™å®¢æˆ·ç«¯ä¼šè¢«æµè§ˆå™¨è§£æ
        response_header = 'Server:Cyanine Hrrp Server\r\nContent-Type:text/html\r\n'
        #è¿”å›çš„htmlä»£ç  ä¹Ÿå°±æ˜¯é¡µé¢ä¸»é¢˜ æœ€åŸºæœ¬çš„å¼€å‘å°±æ˜¯éœ€è¦åœ¨ä»£ç ä¸­ç¡¬åµŒå…¥htmlé¡µé¢ä»£ç 
        response_body = &quot;&lt;html&gt;&quot;\
                            &quot;&lt;head&gt;&quot;\
                                &quot;&lt;meta charset=utf-8&gt;&quot;\
                                &quot;&lt;title&gt;Cyanine Http Server Response&lt;/title&gt;&quot;\
                            &quot;&lt;/head&gt;&quot;\
                            &quot;&lt;body&gt;&quot;\
                                &quot;&lt;h1&gt;&quot;\
                                &quot;Cyanine's Http server response...&quot;\
                                &quot;&lt;/h1&gt;&quot;\
                            &quot;&lt;/body&gt;&quot;\
                        &quot;&lt;/html&gt;&quot;
        #è¦æ³¨æ„åœ¨å“åº”å¤´å’Œå“åº”bodyä¹‹é—´æ·»åŠ æ¢è¡Œ å¦åˆ™æµè§ˆå™¨ä¸èƒ½è§£æå‡ºå“åº”å†…å®¹
        response = response_start_line + response_header + '\r\n'+response_body
        client_socket.send(bytes(response,'UTF-8')) #æœåŠ¡å™¨å“åº”
        client_socket.close() #httpsæ˜¯æ— çŠ¶æ€åè®® å› æ­¤ç›¸åº”å®Œæˆä¸€æ¬¡ä¹‹åå°±ä¼šå…³é—­è¿æ¥

def main():
    #80ç«¯å£å¤§éƒ¨åˆ†æœåŠ¡çš„é»˜è®¤ç«¯å£ å› æ­¤å¦‚æœä½¿ç”¨çš„è¯ å°±å¯ä»¥ç›´æ¥å±äºåŸŸå/ä¸»æœºåœ°å€è®¿é—®æœåŠ¡
    #å¦‚æœä¸æ˜¯çš„è¯ éœ€è¦æŒ‡å®šç«¯å£ :**
    http_server = HttpServer(9090)
    http_server.start()
if __name__ == '__main__':
    main()
</code></pre>
<p>ä¸€äº›ä»£ç æ›´è¯¦ç»†çš„è®²è§£<br>
<code>self.server_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM) #å®ä¾‹socketå¯¹è±¡</code><br>
ocket(family,type[,protocol])å‡½æ•°ä¸­ï¼Œfamily æŒ‡å®šåº”ç”¨ç¨‹åºä½¿ç”¨çš„é€šä¿¡åè®®çš„åè®®æ—ï¼Œå¯¹äºTCP/IPåè®®æ—ï¼Œè¯¥å‚æ•°ä¸ºAF_INETï¼›type æ˜¯è¦åˆ›å»ºå¥—æ¥å­—çš„ç±»å‹ï¼Œsocket.SOCK_STREAMè¡¨ç¤ºæµå¼socketï¼Œä½¿ç”¨TCPåè®®çš„æ—¶å€™é€‰æ‹©æ­¤å‚æ•°ï¼ŒSOCK_DGRAMæ•°æ®æŠ¥å¼socketï¼Œä½¿ç”¨UDPåè®®çš„æ—¶å€™é€‰æ‹©æ­¤å‚æ•°ï¼›protocol æŒ‡æ˜æ‰€è¦æ¥æ”¶çš„åè®®ç±»å‹ï¼Œé€šå¸¸ä¸º0æˆ–è€…ä¸å¡«ã€‚<br>
<code>self.server_socket.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1) #è¿›è¡Œsocketé€‰é¡¹è®¾ç½®  level: è®¾ç½®é€‰é¡¹æ‰€åœ¨çš„åè®®å±‚ç¼–å·ï¼Œæœ‰å››ä¸ªå¯ç”¨é…ç½®é¡¹ï¼Œå…¶ä¸­socket.SOL_SOCKETè¡¨ç¤ºåŸºæœ¬åµŒå¥—å­—æ¥å£....å‰©ä¸‹çš„å¥½å¤æ‚ï¼Œçœ‹ä¸å¤ªæ‡‚ï¼Œæš‚ä¸”æ”¾ä¸‹ã€‚çœ‹åˆ°çš„[å‚è€ƒ](https://blog.csdn.net/c_base_jin/article/details/94353956) </code>client_socket.send(bytes(response,'UTF-8')) #æœåŠ¡å™¨å“åº”<br>
ä½¿ç”¨<code>bytes</code>çš„åŸå› æ˜¯socketåªèƒ½å‘é€å­—èŠ‚æ•°æ®æµï¼Œå› æ­¤éœ€è¦å°†responseè½¬æ¢ä¸ºbytesç±»å‹ï¼Œå†å‘é€ã€‚</p>
<h1 id="-2">=&gt;</h1>
<p>httpæœåŠ¡å™¨å»ºç«‹ç›¸åº”ç›®å½•<br>
ä¹‹å‰çš„httpæœåŠ¡åªèƒ½è¿›è¡Œä¸€æ¬¡å›ºå®šçš„å“åº”ï¼Œå¹¶ä¸”htmlä»£ç å‡ºç°åœ¨pythonä»£ç ä¸­ä¸æ–¹ä¾¿ä¿®æ”¹ï¼Œæ²¡æœ‰è¿›è¡Œå‰åç«¯åˆ†ç¦»ï¼Œè¾ƒä¸ºè½åã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œç›®å½•ä¸‹æœ‰ä¸åŒçš„HTMLé¡µé¢ï¼Œæ ¹æ®è¯·æ±‚çš„ä¸åŒï¼Œç›¸åº”å“åº”ç›®å½•ä¸‹å¯¹åº”çš„htmlæ–‡ä»¶ã€‚<br>
å…·ä½“å®ç°ï¼š</p>
<pre><code class="language-python"># æ·»åŠ ç›¸åº”ç›®å½• åŸå› åœ¨äºä»£ç ç»´æŠ¤ä»¥åŠæ›´åŠ é«˜æ•ˆçš„å“åº”
# éœ€è¦æ³¨æ„ è¯»å–htmlæˆ–è€…å…¶ä»–æ–‡ä»¶éƒ½æ˜¯ä»¥bytesçš„æ ¼å¼
# osçš„æ³¨æ„ç‚¹ os.getcwd() os.sep os.path.normpath()
# æ­£åˆ™çš„å†™æ³• æš‚ä¸åšè¯¦ç»†äº†è§£ 

import socket
import os #oså¤„ç†å“åº”æ–‡ä»¶ç›®å½•
import re #æ­£åˆ™åŒ¹é…è¯·æ±‚ä¸­çš„æ–‡ä»¶åœ°å€
import multiprocessing
HTML_ROOT_DIR = os.getcwd() + os.sep + &quot;template&quot;

class HttpServer:
    def __init__(self,port):  #è¿›è¡Œsocketåˆå§‹è®¾ç½® ç»‘å®šç«¯å£å¼€å¯ç›‘å¬
        self.port = port
        self.server_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM) #å®ä¾‹socketå¯¹è±¡
        self.server_socket.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1) #è¿›è¡Œsocketé€‰é¡¹è®¾ç½®
        self.server_socket.bind(('0.0.0.0',port)) #ç»‘å®šç›‘å¬ç«¯å£
        self.server_socket.listen() #å¼€å¯ç›‘å¬ åœ¨æ„é€ å‡½æ•°å†…å¼€å¯ç›‘å¬ä»£è¡¨æ¯ä¸€ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªhttpæœåŠ¡å™¨ç¨‹åº

    def start(self): #æ¥æ”¶æœåŠ¡ç«¯ä¿¡æ¯ è¿›è¡Œå¤„ç†
        while True:
            client_scoket, client_addr = self.server_socket.accept()
            print(f'ã€æ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‘å®¢æˆ·ç«¯ip{client_addr[0]},è®¿é—®ç«¯å£{client_addr[1]}')
            handle_socket = multiprocessing.Process(target=self.handle_response,args=(client_scoket,))#å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯è¯·æ±‚
            handle_socket.start()
    
    #è¯»å–å¯¹åº”æ–‡ä»¶æ•°æ®
    def read_file(self,file_name):
        file_path = os.path.normpath(HTML_ROOT_DIR + file_name)
        print('ã€è¯·æ±‚æ–‡ä»¶è·¯å¾„ã€‘'+ file_path)
        f = open(file_path,'rb') #äºŒè¿›åˆ¶è¯»å–
        file_data = f.read()
        f.close()
        print('ã€è¯·æ±‚æ–‡ä»¶è·¯å¾„ã€‘è¯¥æ–‡ä»¶è¯·æ±‚ç»“æŸï¼')
        return file_data

    #è·å–äºŒè¿›åˆ¶æ–‡ä»¶
    def get_binary_data(self,file_name):
        response_body = self.read_file(file_name)
        return response_body

    #è¯»å–htmlæ–‡ä»¶ è¿”å›ç›¸åº”çš„ä¿¡æ¯
    def get_html_file(self,file_name):
        response_start_line = 'HTTP/1.1 200 OK\r\n' #æœ¬æ¬¡ç›¸åº”æˆåŠŸ
        #æ‰‹åŠ¨å†™httpå“åº”å¤´ ä¹‹åä¼šå‘é€ç»™å®¢æˆ·ç«¯ä¼šè¢«æµè§ˆå™¨è§£æ
        response_header = 'Server:Cyanine Hrrp Server\r\nContent-Type:text/html\r\n'
        response_body = self.read_file(file_name)
        return response_start_line + response_header + '\r\n' + response_body.decode('utf-8')
    def handle_response(self,client_socket): #å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯
        request_headers = client_socket.recv(1024)
        print(f'ã€å®¢æˆ·ç«¯æ¸…è¯·æ±‚å¤´ä¿¡æ¯ã€‘{request_headers}') #å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¿¡æ¯
        file_name = re.match(r&quot;\w+ +(/[^ ]*)&quot;, request_headers.decode('utf-8').split('\r\n')[0]).group(1)
        if file_name == &quot;/&quot;: #å¦‚æœè¯·æ±‚çš„æ˜¯æ ¹ç›®å½• é‚£ä¹ˆå®é™…è®¿é—®çš„æ˜¯index.htmlé¡µé¢
            file_name = '/index.html'
        if file_name.endswith(&quot;.html&quot;) or file_name.endswith(&quot;.htm&quot;):
            client_socket.send(bytes(self.get_html_file(file_name),'utf-8'))
        else:
            response_start_line = 'HTTP/1.1 200 OK\r\n' #æœ¬æ¬¡å“åº”æˆåŠŸ
            response_header ='Server:Cyanine Hrrp Server\r\nContent-Type:image/x-icon\r\n'
            client_socket.send((response_start_line + response_header + '\r\n').encode('utf-8'))
            client_socket.send(self.get_binary_data(file_name))
        client_socket.close() #httpsæ˜¯æ— çŠ¶æ€åè®® å› æ­¤ç›¸åº”å®Œæˆä¸€æ¬¡ä¹‹åå°±ä¼šå…³é—­è¿æ¥

def main():
    #80ç«¯å£å¤§éƒ¨åˆ†æœåŠ¡çš„é»˜è®¤ç«¯å£ å› æ­¤å¦‚æœä½¿ç”¨çš„è¯ å°±å¯ä»¥ç›´æ¥å±äºåŸŸå/ä¸»æœºåœ°å€è®¿é—®æœåŠ¡
    #å¦‚æœä¸æ˜¯çš„è¯ éœ€è¦æŒ‡å®šç«¯å£ :**
    http_server = HttpServer(70)
    http_server.start()
    
if __name__ == '__main__':
    main()
</code></pre>
<p>ä»£ç ç»†èŠ‚è§£æ<br>
ä¸€è¿™æ˜¯ä¸€ä¸ªç®€å•çš„httpæœåŠ¡å™¨ç›¸åº”ç›®å½•ï¼Œåªæ˜¯ç®€å•å¤„ç†index.htmlã€hello.htmlä»¥åŠfavicon.icoæ–‡ä»¶ï¼›äºŒä¸ºäº†ç»“æ„æ¸…æ™°ï¼Œå°½ç®¡è·å–<code>get_binary_data()</code>æ–¹æ³•åªæ˜¯ç»™<code>read_file</code>æ¢äº†ä¸ªåå­—ï¼Œä½†æ˜¯èƒ½å¤Ÿå°†åŠŸèƒ½æ›´åŠ æ¸…æ™°çš„åˆ†å‰²å¼€æ¥ï¼›ä¸‰ä¸ç®¡ä»€ä¹ˆå“åº”ï¼Œéƒ½è¦è®°å¾—æ·»åŠ å¯¹åº”çš„httpå“åº”å¤´ï¼›å››å“åº”å¤´å’Œå“åº”å†…å®¹å’Œåˆ†å¼€å‘é€ï¼›äº”è¦æ³¨æ„æ‰‹å†™å“åº”å¤´çš„æ—¶å€™å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„<code>\r\n</code>ï¼›<br>
åŒæ—¶è¿™é‡Œè¿˜é‡åˆ°äº†ä¸€ä¸ªéš¾ä»¥ç†è§£çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯ä»¥80ç«¯å£å¯åŠ¨æœåŠ¡ï¼Œé‚£ä¹ˆå°±ç®—faviconçš„è¯·æ±‚æ²¡æœ‰å“åº”å¤´ï¼Œæµè§ˆå™¨ä¹Ÿä¼šæ­£ç¡®è§£æå‡ºæ¥å¹¶æ˜¾ç¤ºå›¾æ ‡ï¼Œä½†æ˜¯å¦‚æœæ¢æˆå…¶ä»–çš„ç«¯å£ï¼Œé‚£ä¹ˆå°±ä¸èƒ½æ­£å¸¸ç›¸åº”ï¼Œå¿…é¡»è¦æ·»åŠ å“åº”å¤´ã€‚çŒœæµ‹å¯èƒ½æ˜¯å› ä¸º80ç«¯å£æ˜¯é»˜è®¤ï¼Œè€Œè¯·æ±‚faviconä¹Ÿæ˜¯é»˜è®¤çš„ä¸€ä¸ªè¯·æ±‚ï¼Œå› æ­¤åœ¨è¿™ä¸ªæ´»åŠ¨ä¸­ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è§£ææŠŠï¼Œä½†æ˜¯éé»˜è®¤ç«¯å£å°±ä¸å¯ä»¥ã€‚<a href="https://blog.csdn.net/laocooon/article/details/130762587#comments_27306408">å’Œä¸€ä½ç›¸åŒé—®é¢˜çš„å¤§ä½¬çš„è®¨è®ºä»¥åŠä»–çš„ä»£ç </a>ã€‚è¿™ä¸ªé—®é¢˜æ€ä¹ˆä¹Ÿæ‰¾ä¸åˆ°ç­”æ¡ˆï¼Œå› æ­¤æš‚ä¸”æç½®å§ğŸ˜­ã€‚æ€»æ˜¯è¿˜æ˜¯è¦è®°å¾—åœ¨æ¯ä¸€ä¸ªå“åº”å‰æ·»åŠ å“åº”å¤´ã€‚ä¸è¿‡å½“ç„¶é’ˆå¯¹ç®€å•çš„ï¼Œå¤æ‚çš„è¯æœ‰å¾ˆå¤šwebæ¡†æ¶ä¼šå¸®æˆ‘ä»¬æ»´~~~</p>
<h1 id="-3">=&gt;</h1>
<p>åŠ¨æ€è¯·æ±‚å¤„ç†<br>
webæœ‰ä¸¤ä¸ªå¤„ç†é˜¶æ®µï¼šé™æ€å¤„ç†é˜¶æ®µã€åŠ¨æ€å¤„ç†é˜¶æ®µã€‚<br>
ä¹‹å‰çš„å“åº”ç›®å½•å®é™…ä¸Šæ˜¯é™æ€å¤„ç†ï¼Œè€ŒåŠ¨æ€webæ˜¯å¯ä»¥æ ¹æ®åŠ¨æ€çš„åˆ¤æ–­å†³å®šæœ€ç»ˆè¿”å›çš„æ•°æ®å†…å®¹ã€‚<br>
pythonåŠ¨æ€å¤„ç†å®ç°ï¼š(åªæ˜¯ç®€å•çš„åŸç†äº†è§£ï¼Œä¸æ¶‰åŠå¤æ‚çš„åŠ¨æ€ç›¸åº”æ¡†æ¶)</p>
<pre><code class="language-python"># å¤„ç†åŠ¨æ€è¯·æ±‚ 
import socket
import os #oså¤„ç†å“åº”æ–‡ä»¶ç›®å½•
import re #æ­£åˆ™åŒ¹é…è¯·æ±‚ä¸­çš„æ–‡ä»¶åœ°å€
import multiprocessing
HTML_ROOT_DIR = os.getcwd() + os.sep + &quot;template&quot;
import sys 
sys.path.append('packages')

class HttpServer:
    def __init__(self,port):  #è¿›è¡Œsocketåˆå§‹è®¾ç½® ç»‘å®šç«¯å£å¼€å¯ç›‘å¬
        self.port = port
        self.server_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM) #å®ä¾‹socketå¯¹è±¡
        self.server_socket.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1) #è¿›è¡Œsocketé€‰é¡¹è®¾ç½®
        self.server_socket.bind(('0.0.0.0',port)) #ç»‘å®šç›‘å¬ç«¯å£
        self.server_socket.listen() #å¼€å¯ç›‘å¬ åœ¨æ„é€ å‡½æ•°å†…å¼€å¯ç›‘å¬ä»£è¡¨æ¯ä¸€ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªhttpæœåŠ¡å™¨ç¨‹åº

    def start(self): #æ¥æ”¶æœåŠ¡ç«¯ä¿¡æ¯ è¿›è¡Œå¤„ç†
        while True:
            client_scoket, client_addr = self.server_socket.accept()
            print(f'ã€æ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‘å®¢æˆ·ç«¯ip{client_addr[0]},è®¿é—®ç«¯å£{client_addr[1]}')
            handle_socket = multiprocessing.Process(target=self.handle_response,args=(client_scoket,))#å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯è¯·æ±‚
            handle_socket.start()

    def handle_response(self,client_socket): #å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä¿¡æ¯
        request_headers = client_socket.recv(1024)
        print(f'ã€å®¢æˆ·ç«¯æ¸…è¯·æ±‚å¤´ä¿¡æ¯ã€‘{request_headers}') #å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¿¡æ¯
        file_name = re.match(r&quot;\w+ +(/[^ ]*)&quot;, request_headers.decode('utf-8').split('\r\n')[0]).group(1)
        if file_name.startswith('/packages'): #è®¿é—®åŠ¨æ€é¡µé¢
            #è·å–åŠ¨æ€å‚æ•° 
            request_name = file_name[file_name.index('/',1)+1:]#è®¿é—®è·¯å¾„
            # print(&quot;è®¿é—®è·¯å¾„ï¼š&quot;+request_name)
            param_value = '' #è¯·æ±‚å‚æ•°
            if request_name.__contains__('?') :#ï¼Ÿæ˜¯urlä¸­çš„å‚æ•°åˆ†éš”ç¬¦å·
                request_value = request_name[request_name.index('?') + 1 :]
                param_value = request_value.split('=')[1]
                request_name = request_name[0:request_name.index('?')]
                # print(request_name)
            model_name = request_name.split('/')[0]
            method_name = request_name.split('/')[1]
            model = __import__(model_name)
            method = getattr(model,method_name)
            response_body = method(param_value)
            print('ã€å“åº”æ•°æ®æ˜¯ã€‘ï¼š'+response_body)

            response_start_line = 'HTTP/1.1 200 OK\r\n' 
            #æ‰‹åŠ¨å†™httpå“åº”å¤´ ä¹‹åä¼šå‘é€ç»™å®¢æˆ·ç«¯ä¼šè¢«æµè§ˆå™¨è§£æ
            response_header = 'Server:Cyanine Hrrp Server\r\nContent-Type:text/html\r\n'
            response = response_start_line+response_header+'\r\n'+response_body
            print(response)
            client_socket.send(bytes(response,'UTF-8'))
        client_socket.close()


def main():
    #80ç«¯å£å¤§éƒ¨åˆ†æœåŠ¡çš„é»˜è®¤ç«¯å£ å› æ­¤å¦‚æœä½¿ç”¨çš„è¯ å°±å¯ä»¥ç›´æ¥å±äºåŸŸå/ä¸»æœºåœ°å€è®¿é—®æœåŠ¡
    #å¦‚æœä¸æ˜¯çš„è¯ éœ€è¦æŒ‡å®šç«¯å£ :**
    http_server = HttpServer(80)
    http_server.start()
    
if __name__ == '__main__':
    #http://localhost/packages/echo/service?param=canshu
    main()
</code></pre>
<p>åŒæ—¶è¿˜éœ€è¦ä¸€ä¸ªåœ¨åŒç›®å½•ä¸‹çš„packagesæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶è·¯å¾„å¦‚ä¸‹</p>
<pre><code>â”œâ”€packages
â”‚  â”‚  echo.py
â”‚  â”‚  __init__.py
â”‚  â”‚  
â”‚  â””â”€__pycache__
â”‚          echo.cpython-310.pyc
â”‚          echo.cpython-311.pyc
â”‚          
â”œâ”€template
â”‚      favicon.ico
â”‚      hello.html
â”‚      index.html
â”‚        
â”œâ”€ç½‘ç»œç¼–ç¨‹
â”‚      01-server.py
â”‚      02-client.py
â”‚      03-echo-server.py
â”‚      04-echo-client.py
â”‚      05-UDP-server.py
â”‚      06-UDP-client.py
â”‚      07-broadcast-client.py
â”‚      08-broadcast-server.py
â”‚      09-http-server.py
â”‚      10-http-lib-server.py
â”‚      11-dynamic-request.py #è¿™ä¸ªæ˜¯æœ¬æ–‡ä»¶
</code></pre>
<p>å…¶ä¸­çš„/packages/echo.pyæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">def service(text):
    if text:
        response = f'&lt;head&gt;&lt;title&gt;Cyanine\'s Http Server&lt;/title&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;å‚æ•°ä¿¡æ¯ï¼š{text}&lt;/h1&gt;&lt;/body&gt;'
        return response
    else:
        return '&lt;h1&gt;æ²¡æœ‰å‚æ•°ä¿¡æ¯&lt;/h1&gt;'
</code></pre>
<p>éœ€è¦æ³¨æ„çš„ï¼š<br>
ä¸€åœ¨<code>packages</code>æ–‡ä»¶å¤¹ä¸‹ä¸€å®šè¦æœ‰<code>__init.py__</code>æ–‡ä»¶ï¼Œè¿™æ ·æ‰èƒ½åœ¨<code>__import__</code>çš„æ—¶å€™æ­£ç¡®è¯†åˆ«åˆ°æ¨¡å—ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æå‰è®¾å®šé»˜è®¤çš„æ¨¡å—è·¯å¾„ï¼ˆ<code>sys.path.append(path/to/module)</code>ï¼‰ï¼›äºŒå“åº”çš„æ—¶å€™é™¤äº†éœ€è¦ç¡®å®šå“åº”å¤´ï¼Œåœ¨å“åº”çš„htmlä»£ç ä¸­éœ€è¦è§„å®šç¼–ç æ–¹å¼ï¼Œå¦åˆ™ä¼šå‡ºç°ä¹±ç ï¼ˆ<code>&lt;meta charset=utf-8&gt;</code>)ï¼›ä¸‰åŠ¨æ€å¤„ç†æˆ‘åˆšå¬èµ·æ¥é«˜å¤§ä¸Šï¼Œä½†å®é™…ä¸Šæ“ä½œä¸€éï¼Œæ„Ÿå—å°±æ˜¯å¯¹urlçš„è§£æï¼ŒåŠ ä¸Šä¸€äº›ç¨‹åºå¤„ç†å‚æ•°ï¼Œå°±æ˜¯åŠ¨æ€å¤„ç†ï¼›å››åŠ¨æ€å¤„ç†urléœ€è¦ç”¨åˆ°å¾ˆå¤šå¯¹å­—ç¬¦ä¸²çš„æ“ä½œã€‚<br>
PS. å¦å¤–ä¸€ä¸ªæ–¹ä¾¿çš„å°tipsï¼Œåœ¨å†™é¡¹ç›®ç»“æ„çš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œé‡Œä½¿ç”¨<code>tree</code>ä¼šç”Ÿæˆç›®å½•ç»“æ„ï¼Œ<code>tree &gt; txtname.txt</code>ä¼šå°†ç›®å½•è¾“å‡ºåˆ°è¿™ä¸ªtxtæ–‡ä»¶ä¸­ï¼Œå‚æ•°<code>/f</code>ä¼šæ˜¾ç¤ºæ‰€æœ‰çš„æ–‡ä»¶å±‚çº§ï¼Œä¸åŠ å‚æ•°åªä¼šæ˜¾ç¤ºåˆ°æ‰€æœ‰çš„ç›®å½•å±‚çº§ã€‚</p>
<h1 id="-4">=&gt;</h1>
<p>urllib3æ¨¡å—<br>
ç”¨è¿™ä¸ªæ¨¡å—å¯ä»¥å®ç°æµè§ˆå™¨çš„æ¨¡æ‹Ÿè®¿é—®ï¼Œæ˜¯urllibçš„å‡çº§ç‰ˆï¼Œä¸¤è€…åŠŸèƒ½ç±»ä¼¼ï¼Œåªæœ‰ç»†å¾®å·®åˆ«ã€‚</p>
<h1 id="-5">=&gt;</h1>
<p>Twistedæ¨¡å— (ç±»ä¼¼javaä¸­nio)<br>
æ˜¯pythonä¸­ä¸“é—¨å®ç°å¼‚æ­¥å¤„ç†çš„ioæ¦‚å¿µï¼Œä¸»è¦æ˜¯æå‡æœåŠ¡ç«¯çš„æ•°æ®å¤„ç†èƒ½åŠ›ã€‚ç†è§£twistedçš„è®¾è®¡æ€æƒ³ï¼Œé‚£ä¹ˆéœ€è¦å¯¹æ¯”ä¼ ç»Ÿçš„æœåŠ¡å™¨ç¨‹åºå¼€å‘ã€‚æ—©æœŸæ²¡æœ‰å¤šæ ¸CPUæ¦‚å¿µï¼Œå•çº¿ç¨‹å¤„ç†çš„æ•ˆç‡ä½ä¸‹ï¼Œå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æœ‰å¯èƒ½äº§ç”Ÿæ­»é”é—®é¢˜ï¼ˆä¸åŒè¿›ç¨‹ä»¥åŠçº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…å’Œå”¤é†’æœºåˆ¶ï¼‰ï¼ˆå› ä¸ºéƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªè¿›ç¨‹å»æ‰§è¡Œï¼‰ã€‚æ‰€ä»¥åæ¥ï¼Œå¦‚æœä¸ä½¿ç”¨å¹¶å‘ç¼–ç¨‹ï¼Œå°±ä¸ä¼šäº§ç”Ÿç§ç§é—®é¢˜ï¼ˆèµ„æºåˆ‡æ¢ã€ç³»ç»Ÿè°ƒåº¦ã€åŒæ­¥ä¸ç­‰å¾…ç­‰ï¼‰ï¼Œ</p>
<blockquote>
<p>é˜»å¡è®¾è®¡<br>
æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„recv<br>
ä¼šæµªè´¹å¤§é‡æœåŠ¡å™¨èµ„æº -&gt; è¿™å°±æ˜¯é˜»å¡IO</p>
</blockquote>
<p>å¤šçº¿ç¨‹æ˜¯ä¸èƒ½è§£å†³é˜»å¡IOçš„ï¼Œå› æ­¤æœ€å¥½çš„æ–¹æ³•æ˜¯éé˜»å¡IOï¼ˆåˆ†ä¸ºåŒæ­¥éé˜»å¡IOå’Œå¼‚æ­¥éé˜»å¡IOï¼‰ï¼Œå› æ­¤å®ç°ä¸‹æ¥å°±æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä¸æ–­åœ°è¿›è¡Œå¾ªç¯å¤„ç†<br>
-&gt; twistedæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨å‹çš„ç½‘ç»œå¼•æ“ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æä¾›æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼Œå½“å¤–éƒ¨äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½¿ç”¨å›è°ƒæœºåˆ¶æ¥è§¦å‘ç›¸åº”çš„æ“ä½œå¤„ç†ï¼Œå¤šä¸ªä»»åŠ¡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä½¿ç¨‹åºå°½å¯èƒ½åœ°å‡å°‘å¯¹å…¶å®ƒçº¿ç¨‹çš„ä»¥æ¥ï¼Œä¹Ÿä½¿å¾—ç¨‹åºå¼€å‘äººå‘˜ä¸å†å…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚<br>
-&gt; twistedä¸­çš„æ‰€æœ‰å¤„ç†äº‹ä»¶å…¨éƒ¨äº¤ç»™reactorè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚<br>
-&gt; reactor è¿›è¡Œæ‰€æœ‰è¾“å‡ºè¾“å‡ºæœ‰å…³çš„äº‹ä»¶æ³¨å†Œã€‚åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œä¸­ï¼Œreactorå¾ªç¯ä¼šä»¥å•çº¿ç¨‹çš„å½¢å¼æŒç»­è¿è¡Œï¼Œå½“éœ€è¦æ‰§è¡Œå›è°ƒå¤„ç†çš„æ—¶å€™ä¼šåœæ­¢å¾ªç¯ï¼Œå½“å›è°ƒæ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åå°†ç»§ç»­é‡‡ç”¨å¾ªç¯çš„å½¢å¼è¿›è¡Œå…¶ä»–ä»»åŠ¡å¤„ç†ã€‚</p>
<h1 id="-6">=&gt;</h1>
<p>ä½¿ç”¨twistedå¼€å‘TCPç¨‹åº<br>
ä¼šä½¿æœåŠ¡ç«¯çš„èµ„æºåˆ©ç”¨å¸¦æ¥æå¤§ä¾¿åˆ©ã€‚</p>
<ol>
<li>æœåŠ¡ç«¯ï¼š</li>
</ol>
<pre><code class="language-python">import twisted
import twisted.internet.protocol
import twisted.internet.reactor

SERVER_PORT = 8080

class Server(twisted.internet.protocol.Protocol): #ç»§æ‰¿çˆ¶ç±»
    def connectionMade(self): #å¤å†™æœåŠ¡ç«¯è¿æ¥æ–¹æ³•
        print(f'å®¢æˆ·ç«¯{self.transport.getPeer().host}è¿æ¥æˆåŠŸ...')
        return super().connectionMade() 
    def dataReceived(self, data: bytes): #å¤å†™æœåŠ¡ç«¯æ•°æ®æ¥æ”¶æ–¹æ³•
        print('ã€æœåŠ¡ç«¯æ”¶åˆ°æ•°æ®ã€‘' + data.decode('utf-8')) #å¤„ç†æ“ä½œ
        self.transport.write(('ã€ECHOã€‘' + data.decode('utf-8')).encode('UTF-8')) #è¿›è¡Œå›åº” ç±»æ¯”socketçš„send
        return super().dataReceived(data)

#æ³¨å†Œreactor
#reactoræ ¹æ®å·¥å‚è·å¾—ç›¸åº”äº‹ä»¶å›è°ƒå¤„ç†ç±»
class DefaultServerFactory(twisted.internet.protocol.Factory):
    protocol = Server

def main():
    #æœåŠ¡ç›‘å¬
    twisted.internet.reactor.listenTCP(SERVER_PORT,DefaultServerFactory())
    print('æœåŠ¡å™¨å¯åŠ¨å®Œæ¯•ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...')
    twisted.internet.reactor.run()

if __name__ == '__main__':
    main()
</code></pre>
<ol start="2">
<li>å®¢æˆ·ç«¯</li>
</ol>
<pre><code class="language-python">import twisted
import twisted.internet.protocol
import twisted.internet.reactor

SERVER_PORT = 8080
SERVER_HOST = 'localhost'

class Client(twisted.internet.protocol.Protocol):
    def connectionMade(self):
        print('æœåŠ¡å™¨è¿æ¥æˆåŠŸ...')
        self.send() #å»ºç«‹è¿æ¥ä¹‹åå°±å‘é€æ•°æ®
        return super().connectionMade()
    
    def send(self): #è‡ªå®šä¹‰å‘é€çš„æ–¹å¼
        input_data = input('è¯·è¾“å…¥å‘é€çš„æ•°æ®:')
        if input_data:
            self.transport.write(input_data.encode('utf-8'))
        else:
            self.transport.loseConnection() #å¦‚æœæ²¡æœ‰æ•°æ®å‘é€å°±å…³é—­è¿æ¥
    def dataReceived(self, data: bytes): #æ¥æ”¶æœåŠ¡ç«¯çš„æ•°æ®
        print(data.decode('utf-8'))
        self.send() #è¿›è¡Œä¸‹ä¸€æ¬¡æ•°æ®å‘é€
        return super().dataReceived(data)
    
class DefaultClientfactory(twisted.internet.protocol.ClientFactory):
    protocol = Client
    #å¦‚æœè¿æ¥æ–­å¼€ å°±åœæ­¢reactorçš„å¾ªç¯
    clientConnectLost = clientCOnnectionFailed = lambda self, connector,reason : twisted.internet.reactor.stop()

def main():
    twisted.internet.reactor.connectTCP(SERVER_HOST,SERVER_PORT,DefaultClientfactory()) #æœåŠ¡ç›‘å¬
    twisted.internet.reactor.run() #å¯åŠ¨reactorå¾ªç¯

if __name__ == '__main__':
    main()
</code></pre>
<p>æ•´ä¸ªæ¡†æ¶è¿˜æ˜¯å¤„äºä¸€ä¸ªæ¨¡ç³ŠçŠ¶æ€ï¼Œä½†æ˜¯å¯¹twistedçš„äº‹ä»¶è½®è¯¢æœºåˆ¶è¿˜æ˜¯æœ‰äº†ä¸€ç‚¹æ¸…æ¥šçš„è®¤çŸ¥ã€‚<br>
æˆ‘çš„ç†è§£:</p>
<blockquote>
<p>å°†æ•°æ®çš„å¤„ç†å’Œæ•°æ®çš„æ¥æ”¶å‘é€ã€æœåŠ¡å™¨çš„è¿æ¥è¿™ä¸¤ä¸ªéƒ¨åˆ†å‰¥ç¦»å¼€ã€‚åœ¨reactorä¸­å¦‚æœæ¥æ”¶åˆ°ä¸€ä¸ªä¿¡æ¯ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨åˆ°twistedå¾ªç¯ä¸­çš„æŸä¸ªå¤„ç†ç¨‹åºï¼Œç„¶åå¤„ç†å®Œæˆä¹‹åå°†æ•°æ®è¿”å›ç»™reactorè¿›è¡Œå‘é€ï¼Œç„¶åtwistedäº‹ä»¶å°±ä¼šç»§ç»­å¾ªç¯ã€‚ç›¸å½“äºå°†ä¸€ä¸ªsocketè¿›ç¨‹ä¸­çš„accept()é˜»å¡å’Œå®é™…çš„å¤„ç†å‰¥ç¦»å¼€ï¼Œè®©å¤„ç†ç¨‹åºä¸å—åˆ°é˜»å¡ç¨‹åºçš„å½±å“ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­é«˜æ•ˆçš„å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼ŒèŠ‚çœäº†æœåŠ¡å™¨çš„èµ„æºã€‚<br>
ï¼ˆæœ‰ç‚¹åƒä¸¤ä¸ªåœˆï¼Œreactorä¸€ä¸ªåœˆï¼Œtwistedä¸€ä¸ªåœˆï¼Œå½“é‡åˆ°æ•°æ®éœ€è¦å¤„ç†çš„æ—¶å€™ä¸¤ä¸ªåœˆå°±ä¼šè¿ä¸€æ¡çº¿ï¼Œå¤„ç†å®Œä¹‹åå°±æŠŠçº¿æ“¦å»ï¼‰</p>
</blockquote>
<h1 id="-7">=&gt;</h1>
<p>æš‚æ—¶å…ˆåˆ°è¿™é‡Œï¼Œåé¢è¿˜æœ‰twistedçš„UDPå®¢æˆ·ç«¯å¼€å‘ä»¥åŠdeferredçš„æ¦‚å¿µã€‚ -- 2023-06-26</p>
<p>deferred</p>
]]></content>
    </entry>
</feed>